[{"path":"https://marine-ecologist.github.io/reefspawn/LICENSE.html","id":null,"dir":"","previous_headings":"","what":"MIT License","title":"MIT License","text":"Copyright (c) 2025 reefspawn authors Permission hereby granted, free charge, person obtaining copy software associated documentation files (“Software”), deal Software without restriction, including without limitation rights use, copy, modify, merge, publish, distribute, sublicense, /sell copies Software, permit persons Software furnished , subject following conditions: copyright notice permission notice shall included copies substantial portions Software. SOFTWARE PROVIDED “”, WITHOUT WARRANTY KIND, EXPRESS IMPLIED, INCLUDING LIMITED WARRANTIES MERCHANTABILITY, FITNESS PARTICULAR PURPOSE NONINFRINGEMENT. EVENT SHALL AUTHORS COPYRIGHT HOLDERS LIABLE CLAIM, DAMAGES LIABILITY, WHETHER ACTION CONTRACT, TORT OTHERWISE, ARISING , CONNECTION SOFTWARE USE DEALINGS SOFTWARE.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/articles/brms.html","id":"parameter-estimates","dir":"Articles","previous_headings":"","what":"1. Parameter estimates","title":"Bayesian models","text":"data sourced Lizard Island corals via Álvarez-Noriega et al 2016 Madin et al 2023. Main data available package coralsize:  Data subset 2011 (last datapoint) predict size distributions: plot fitted distributions (yellow) raw data:  Predict total number oocytes per species * size: Extract conditional effects:  Predict probability fecundity per species (binary depending colony size: Extract conditional effects:  Predict probability density polyps per cm^2 per species: Extract conditional effects:  Predict proportion coral area reproductive (within sterile growth zone borders):","code":"library(tidyverse) library(forcats) library(units) library(ggplot2) library(fGarch) library(brms)   sp_order <- c(\"Acropora hyacinthus\", \"Acropora cytherea\",               \"Acropora intermedia\", \"Acropora robusta\",                 \"Acropora millepora\", \"Acropora nasuta\", \"Acropora spathulata\",                   \"Acropora humilis\", \"Acropora cf. digitifera\",                \"Goniastrea pectinata\", \"Goniastrea retiformis\")   sp_pal <- c(\"Acropora hyacinthus\" = \"#50676c\", \"Acropora cytherea\" = \"#3a6c8e\",   \"Acropora intermedia\" = \"#2c3687\", \"Acropora robusta\" = \"#7b8ca8\",     \"Acropora spathulata\" = \"#98a062\", \"Acropora millepora\" = \"#665a43\", \"Acropora nasuta\" =  \"#48642f\",       \"Acropora humilis\" = \"#824b3b\", \"Acropora cf. digitifera\" = \"#a47c73\",    \"Goniastrea pectinata\" = \"#999999\", \"Goniastrea retiformis\"= \"#bfbfbf\")  make_paler <- function(color) {   grDevices::adjustcolor(color, alpha.f = 1, red.f = 1.2, green.f = 1.2, blue.f = 1.2) }  # Apply the function to the palette sp_pal <- sapply(sp_pal, make_paler)   size_data <- coralsize |>    mutate(width=sqrt(area_cm2/pi)*2) |>    mutate(species=as.factor(species)) |>    mutate(species=fct_relevel(species,sp_order)) |>    mutate(growthform=fct_recode(species, \"Tabular\"= \"Acropora cytherea\", \"Tabular\"= \"Acropora hyacinthus\",                                          \"Branching\"= \"Acropora intermedia\", \"Branching\"= \"Acropora robusta\",                                         \"Massive\" = \"Goniastrea pectinata\", \"Massive\" = \"Goniastrea retiformis\",                                         \"Corymbose\" = \"Acropora nasuta\", \"Corymbose\" = \"Acropora millepora\", \"Corymbose\" = \"Acropora spathulata\",                                         \"Digitate\" = \"Acropora cf. digitifera\", \"Digitate\" = \"Acropora humilis\"))     ggplot() + theme_bw() + facet_wrap(~growthform, scales=\"free\") +   geom_density(data=size_data, aes(width, fill=species, color=species), alpha=0.3, linewidth=0.6, show.legend=TRUE) +   theme(panel.grid = element_blank()) + ylab(\"\") +   scale_color_manual(values=sp_pal) + scale_fill_manual(values=sp_pal) brm_sizedistribution <- brm(width ~ species,                             data = size_data |> filter(year==2011),                             family = Gamma(link = \"log\"),                             iter = 5000,                             chains = 4,                             cores = 12) fitted_vals <- fitted(brm_sizedistribution, scale = \"response\")  size_data <- size_data |> filter(year==2011) |> mutate(fitted = fitted(brm_sizedistribution, scale = \"response\")[, \"Estimate\"])  ggplot() + theme_bw() + facet_wrap(~species, scales = \"free\") +   geom_density(data = size_data, aes(x = width), fill = \"steelblue\", alpha = 0.5, show.legend=TRUE) +   geom_density(data = size_data, aes(x = fitted), fill = \"orange\", alpha = 0.4, show.legend=TRUE) +   labs(     x = \"Width\",     y = \"Density\",     title = \"Observed vs Predicted Distributions by Species\"   ) brm_fecundity <- brm(eggs ~ log(width)*species,                      cores = 12,                      chains=12,                      iter=4000,                      family = zero_inflated_poisson(),                      prior = c(prior(normal(1, 2), class = Intercept),                                 prior(beta(2, 2), class = zi)                                ),                      data = fecundity) brm_fecundity_cond <- conditional_effects(brm_fecundity, effects = \"width:species\", dpar = \"mu\") brm_fecundity_plots <- brm_fecundity_cond$`width:species` |> as.data.frame() %>%    mutate(species=fct_relevel(species,sp_order)) |>    mutate(growthform=fct_recode(species, \"Tabular\"= \"Acropora cytherea\", \"Tabular\"= \"Acropora hyacinthus\",                                          \"Branching\"= \"Acropora intermedia\", \"Branching\"= \"Acropora robusta\",                                         \"Massive\" = \"Goniastrea pectinata\", \"Massive\" = \"Goniastrea retiformis\",                                         \"Corymbose\" = \"Acropora nasuta\", \"Corymbose\" = \"Acropora millepora\",                                          \"Corymbose\" = \"Acropora spathulata\",                                         \"Digitate\" = \"Acropora cf. digitifera\", \"Digitate\" = \"Acropora humilis\"))  ggplot() + theme_bw() + facet_wrap(~growthform, scales=\"free_y\") + ylab(\"oocytes per polyp\") +   geom_line(data=brm_fecundity_plots, aes(width, estimate__, color=species), show.legend=TRUE) +   geom_ribbon(data=brm_fecundity_plots, aes(width, ymin=lower__, ymax=upper__, fill=species), alpha=0.2, show.legend=TRUE) +   scale_color_manual(values=sp_pal) + scale_fill_manual(values=sp_pal) brm_probability <- brm(reproductive ~ log(width) * species,                        cores = 12,                        chains = 12,                        iter = 4000,                        family = bernoulli(),                        data = fecundity) #| class-source: fold-hide #| message: false #| warning: false #| fig-width: 9.5 #| fig-height: 5  brm_probability_cond <- conditional_effects(brm_probability, effects = \"width:species\", dpar = \"mu\") brm_probability_plots <-  brm_probability_cond$`width:species` |> as.data.frame() %>%    mutate(growthform=fct_recode(species, \"Tabular\"= \"Acropora cytherea\", \"Tabular\"= \"Acropora hyacinthus\",                                          \"Branching\"= \"Acropora intermedia\", \"Branching\"= \"Acropora robusta\",                                         \"Massive\" = \"Goniastrea pectinata\", \"Massive\" = \"Goniastrea retiformis\",                                         \"Corymbose\" = \"Acropora nasuta\", \"Corymbose\" = \"Acropora millepora\", \"Corymbose\" = \"Acropora spathulata\",                                         \"Digitate\" = \"Acropora cf. digitifera\", \"Digitate\" = \"Acropora humilis\"))  ggplot() + theme_bw() + facet_wrap(~growthform, scales=\"free_y\") +   geom_line(data=brm_probability_plots, aes(width, estimate__, color=species), show.legend=TRUE) +   geom_ribbon(data=brm_probability_plots, aes(width, ymin=lower__, ymax=upper__, fill=species), alpha=0.2, show.legend=TRUE) +     scale_color_manual(values=sp_pal) + scale_fill_manual(values=sp_pal) +    ylab(\"Probability of reproductive colonies\") + xlab(\"Colony width\") brm_polyp_density <- brm(cm2 ~ species,                          family = gaussian,                          iter = 10000,                          chains = 8,                          cores = 11,                          data=polyp_density_data) # add a hack to get millepora, assume it's between millepora and nasuta millepora <- polyp_density_data |> filter(species==\"Acropora nasuta\" | species==\"Acropora spathulata\") |>                  mutate(species=\"Acropora millepora\") |>                  mutate(spp = \"AM\")  # rejoin polyp_density_data <- polyp_density_data |> rbind(millepora) |>    mutate(growthform=fct_recode(species, \"Tabular\"= \"Acropora cytherea\", \"Tabular\"= \"Acropora hyacinthus\",                                          \"Branching\"= \"Acropora intermedia\", \"Branching\"= \"Acropora robusta\",                                         \"Massive\" = \"Goniastrea pectinata\", \"Massive\" = \"Goniastrea retiformis\",                                         \"Corymbose\" = \"Acropora nasuta\", \"Corymbose\" = \"Acropora millepora\",                                          \"Corymbose\" = \"Acropora spathulata\",                                         \"Digitate\" = \"Acropora cf. digitifera\", \"Digitate\" = \"Acropora humilis\"))  ### data prep above for the brms model     brm_polyp_density_cond <- conditional_effects(brm_polyp_density, effects = \"species\", dpar = \"mu\")  brm_probability_plots <-  brm_polyp_density_cond$species |> as.data.frame() %>%    mutate(growthform=fct_recode(species, \"Tabular\"= \"Acropora cytherea\", \"Tabular\"= \"Acropora hyacinthus\",                                          \"Branching\"= \"Acropora intermedia\", \"Branching\"= \"Acropora robusta\",                                         \"Massive\" = \"Goniastrea pectinata\", \"Massive\" = \"Goniastrea retiformis\",                                         \"Corymbose\" = \"Acropora nasuta\", \"Corymbose\" = \"Acropora millepora\", \"Corymbose\" = \"Acropora spathulata\",                                         \"Digitate\" = \"Acropora cf. digitifera\", \"Digitate\" = \"Acropora humilis\"))  ggplot() + theme_bw() + facet_wrap(~growthform, scales=\"free\") +   geom_col(data=brm_probability_plots, aes(species, estimate__, fill=species),             color=\"black\", alpha=0.5, linewidth=0.5, show.legend=FALSE) +   geom_errorbar(data=brm_probability_plots, aes(species, estimate__, ymin=lower__, ymax=upper__, fill=species),                  width=0.05, color=\"black\", alpha=0.8, linewidth=0.5, show.legend=FALSE) +   theme(axis.text.x = element_text(angle = 45, vjust = 0.9, hjust=0.8)) +   scale_color_manual(values=sp_pal) + scale_fill_manual(values=sp_pal) +    ylab(bquote('Polyps per'*~cm^2*'')) + xlab(\"\") sterile_zone <- tibble(        species = c(\"Acropora hyacinthus\", \"Acropora cytherea\", \"Acropora cf. digitifera\",                    \"Acropora humilis\", \"Acropora nasuta\", \"Acropora spathulata\",                    \"Acropora millepora\",\"Acropora intermedia\",\"Acropora robusta\"),        lower__ = c(0.760, 0.999, 0.773, 0.995, 0.970, 0.885, 0.885, 0.760, 0.760),        median = c(0.771, 1.000, 0.868, 1.000, 0.999, 0.913, 0.913, 0.771, 0.771),        upper__ = c(0.781, 1.000, 0.936, 1.000, 1.000, 0.941, 0.941, 0.781, 0.781)         )  |>    mutate(growthform=fct_recode(species, \"Tabular\"= \"Acropora cytherea\", \"Tabular\"= \"Acropora hyacinthus\",                                          \"Branching\"= \"Acropora intermedia\", \"Branching\"= \"Acropora robusta\",                                         \"Corymbose\" = \"Acropora nasuta\", \"Corymbose\" = \"Acropora millepora\", \"Corymbose\" = \"Acropora spathulata\",                                         \"Digitate\" = \"Acropora cf. digitifera\", \"Digitate\" = \"Acropora humilis\")) |>    bind_rows(data.frame(species = c(\"Goniastrea retiformis\", \"Goniastrea pectinata\"),                                           lower__ = c(1,1),                                           median = c(1,1),                                           upper__ = c(1,1),                                           growthform = c(\"Massive\",\"Massive\")))  ggplot() + theme_bw() + facet_wrap(~growthform, scales=\"free_x\") +   geom_col(data=sterile_zone, aes(species, median*100, fill=species),             color=\"black\", alpha=0.3, linewidth=0.5, show.legend=FALSE) +   geom_errorbar(data=sterile_zone, aes(species, median*100, ymin=lower__*100, ymax=upper__*100),                  width=0.05, color=\"black\", alpha=0.8, linewidth=0.5, show.legend=FALSE) +    theme(axis.text.x = element_text(angle = 45, vjust = 0.9, hjust=0.8)) +   scale_color_manual(values=sp_pal) + scale_fill_manual(values=sp_pal) +    ylab(\"Proportion colony reproductive\") + xlab(\"\")"},{"path":"https://marine-ecologist.github.io/reefspawn/articles/brms.html","id":"i--colony-size-distributions","dir":"Articles","previous_headings":"","what":"i. Colony size distributions","title":"Bayesian models","text":"Data subset 2011 (last datapoint) predict size distributions: plot fitted distributions (yellow) raw data:","code":"brm_sizedistribution <- brm(width ~ species,                             data = size_data |> filter(year==2011),                             family = Gamma(link = \"log\"),                             iter = 5000,                             chains = 4,                             cores = 12) fitted_vals <- fitted(brm_sizedistribution, scale = \"response\")  size_data <- size_data |> filter(year==2011) |> mutate(fitted = fitted(brm_sizedistribution, scale = \"response\")[, \"Estimate\"])  ggplot() + theme_bw() + facet_wrap(~species, scales = \"free\") +   geom_density(data = size_data, aes(x = width), fill = \"steelblue\", alpha = 0.5, show.legend=TRUE) +   geom_density(data = size_data, aes(x = fitted), fill = \"orange\", alpha = 0.4, show.legend=TRUE) +   labs(     x = \"Width\",     y = \"Density\",     title = \"Observed vs Predicted Distributions by Species\"   )"},{"path":"https://marine-ecologist.github.io/reefspawn/articles/brms.html","id":"ii--polyp-level-fecundity","dir":"Articles","previous_headings":"","what":"ii. Polyp-level fecundity","title":"Bayesian models","text":"Predict total number oocytes per species * size: Extract conditional effects:","code":"brm_fecundity <- brm(eggs ~ log(width)*species,                      cores = 12,                      chains=12,                      iter=4000,                      family = zero_inflated_poisson(),                      prior = c(prior(normal(1, 2), class = Intercept),                                 prior(beta(2, 2), class = zi)                                ),                      data = fecundity) brm_fecundity_cond <- conditional_effects(brm_fecundity, effects = \"width:species\", dpar = \"mu\") brm_fecundity_plots <- brm_fecundity_cond$`width:species` |> as.data.frame() %>%    mutate(species=fct_relevel(species,sp_order)) |>    mutate(growthform=fct_recode(species, \"Tabular\"= \"Acropora cytherea\", \"Tabular\"= \"Acropora hyacinthus\",                                          \"Branching\"= \"Acropora intermedia\", \"Branching\"= \"Acropora robusta\",                                         \"Massive\" = \"Goniastrea pectinata\", \"Massive\" = \"Goniastrea retiformis\",                                         \"Corymbose\" = \"Acropora nasuta\", \"Corymbose\" = \"Acropora millepora\",                                          \"Corymbose\" = \"Acropora spathulata\",                                         \"Digitate\" = \"Acropora cf. digitifera\", \"Digitate\" = \"Acropora humilis\"))  ggplot() + theme_bw() + facet_wrap(~growthform, scales=\"free_y\") + ylab(\"oocytes per polyp\") +   geom_line(data=brm_fecundity_plots, aes(width, estimate__, color=species), show.legend=TRUE) +   geom_ribbon(data=brm_fecundity_plots, aes(width, ymin=lower__, ymax=upper__, fill=species), alpha=0.2, show.legend=TRUE) +   scale_color_manual(values=sp_pal) + scale_fill_manual(values=sp_pal)"},{"path":"https://marine-ecologist.github.io/reefspawn/articles/brms.html","id":"iii--colony-level-fecundity","dir":"Articles","previous_headings":"","what":"iii. Colony-level fecundity","title":"Bayesian models","text":"Predict probability fecundity per species (binary depending colony size: Extract conditional effects:","code":"brm_probability <- brm(reproductive ~ log(width) * species,                        cores = 12,                        chains = 12,                        iter = 4000,                        family = bernoulli(),                        data = fecundity) #| class-source: fold-hide #| message: false #| warning: false #| fig-width: 9.5 #| fig-height: 5  brm_probability_cond <- conditional_effects(brm_probability, effects = \"width:species\", dpar = \"mu\") brm_probability_plots <-  brm_probability_cond$`width:species` |> as.data.frame() %>%    mutate(growthform=fct_recode(species, \"Tabular\"= \"Acropora cytherea\", \"Tabular\"= \"Acropora hyacinthus\",                                          \"Branching\"= \"Acropora intermedia\", \"Branching\"= \"Acropora robusta\",                                         \"Massive\" = \"Goniastrea pectinata\", \"Massive\" = \"Goniastrea retiformis\",                                         \"Corymbose\" = \"Acropora nasuta\", \"Corymbose\" = \"Acropora millepora\", \"Corymbose\" = \"Acropora spathulata\",                                         \"Digitate\" = \"Acropora cf. digitifera\", \"Digitate\" = \"Acropora humilis\"))  ggplot() + theme_bw() + facet_wrap(~growthform, scales=\"free_y\") +   geom_line(data=brm_probability_plots, aes(width, estimate__, color=species), show.legend=TRUE) +   geom_ribbon(data=brm_probability_plots, aes(width, ymin=lower__, ymax=upper__, fill=species), alpha=0.2, show.legend=TRUE) +     scale_color_manual(values=sp_pal) + scale_fill_manual(values=sp_pal) +    ylab(\"Probability of reproductive colonies\") + xlab(\"Colony width\")"},{"path":"https://marine-ecologist.github.io/reefspawn/articles/brms.html","id":"iv--colony-level-polyp-density","dir":"Articles","previous_headings":"","what":"iv. Colony-level polyp density","title":"Bayesian models","text":"Predict probability density polyps per cm^2 per species: Extract conditional effects:","code":"brm_polyp_density <- brm(cm2 ~ species,                          family = gaussian,                          iter = 10000,                          chains = 8,                          cores = 11,                          data=polyp_density_data) # add a hack to get millepora, assume it's between millepora and nasuta millepora <- polyp_density_data |> filter(species==\"Acropora nasuta\" | species==\"Acropora spathulata\") |>                  mutate(species=\"Acropora millepora\") |>                  mutate(spp = \"AM\")  # rejoin polyp_density_data <- polyp_density_data |> rbind(millepora) |>    mutate(growthform=fct_recode(species, \"Tabular\"= \"Acropora cytherea\", \"Tabular\"= \"Acropora hyacinthus\",                                          \"Branching\"= \"Acropora intermedia\", \"Branching\"= \"Acropora robusta\",                                         \"Massive\" = \"Goniastrea pectinata\", \"Massive\" = \"Goniastrea retiformis\",                                         \"Corymbose\" = \"Acropora nasuta\", \"Corymbose\" = \"Acropora millepora\",                                          \"Corymbose\" = \"Acropora spathulata\",                                         \"Digitate\" = \"Acropora cf. digitifera\", \"Digitate\" = \"Acropora humilis\"))  ### data prep above for the brms model     brm_polyp_density_cond <- conditional_effects(brm_polyp_density, effects = \"species\", dpar = \"mu\")  brm_probability_plots <-  brm_polyp_density_cond$species |> as.data.frame() %>%    mutate(growthform=fct_recode(species, \"Tabular\"= \"Acropora cytherea\", \"Tabular\"= \"Acropora hyacinthus\",                                          \"Branching\"= \"Acropora intermedia\", \"Branching\"= \"Acropora robusta\",                                         \"Massive\" = \"Goniastrea pectinata\", \"Massive\" = \"Goniastrea retiformis\",                                         \"Corymbose\" = \"Acropora nasuta\", \"Corymbose\" = \"Acropora millepora\", \"Corymbose\" = \"Acropora spathulata\",                                         \"Digitate\" = \"Acropora cf. digitifera\", \"Digitate\" = \"Acropora humilis\"))  ggplot() + theme_bw() + facet_wrap(~growthform, scales=\"free\") +   geom_col(data=brm_probability_plots, aes(species, estimate__, fill=species),             color=\"black\", alpha=0.5, linewidth=0.5, show.legend=FALSE) +   geom_errorbar(data=brm_probability_plots, aes(species, estimate__, ymin=lower__, ymax=upper__, fill=species),                  width=0.05, color=\"black\", alpha=0.8, linewidth=0.5, show.legend=FALSE) +   theme(axis.text.x = element_text(angle = 45, vjust = 0.9, hjust=0.8)) +   scale_color_manual(values=sp_pal) + scale_fill_manual(values=sp_pal) +    ylab(bquote('Polyps per'*~cm^2*'')) + xlab(\"\")"},{"path":"https://marine-ecologist.github.io/reefspawn/articles/brms.html","id":"v--colony-level-reproductive-area","dir":"Articles","previous_headings":"","what":"v. Colony-level reproductive area","title":"Bayesian models","text":"Predict proportion coral area reproductive (within sterile growth zone borders):","code":"sterile_zone <- tibble(        species = c(\"Acropora hyacinthus\", \"Acropora cytherea\", \"Acropora cf. digitifera\",                    \"Acropora humilis\", \"Acropora nasuta\", \"Acropora spathulata\",                    \"Acropora millepora\",\"Acropora intermedia\",\"Acropora robusta\"),        lower__ = c(0.760, 0.999, 0.773, 0.995, 0.970, 0.885, 0.885, 0.760, 0.760),        median = c(0.771, 1.000, 0.868, 1.000, 0.999, 0.913, 0.913, 0.771, 0.771),        upper__ = c(0.781, 1.000, 0.936, 1.000, 1.000, 0.941, 0.941, 0.781, 0.781)         )  |>    mutate(growthform=fct_recode(species, \"Tabular\"= \"Acropora cytherea\", \"Tabular\"= \"Acropora hyacinthus\",                                          \"Branching\"= \"Acropora intermedia\", \"Branching\"= \"Acropora robusta\",                                         \"Corymbose\" = \"Acropora nasuta\", \"Corymbose\" = \"Acropora millepora\", \"Corymbose\" = \"Acropora spathulata\",                                         \"Digitate\" = \"Acropora cf. digitifera\", \"Digitate\" = \"Acropora humilis\")) |>    bind_rows(data.frame(species = c(\"Goniastrea retiformis\", \"Goniastrea pectinata\"),                                           lower__ = c(1,1),                                           median = c(1,1),                                           upper__ = c(1,1),                                           growthform = c(\"Massive\",\"Massive\")))  ggplot() + theme_bw() + facet_wrap(~growthform, scales=\"free_x\") +   geom_col(data=sterile_zone, aes(species, median*100, fill=species),             color=\"black\", alpha=0.3, linewidth=0.5, show.legend=FALSE) +   geom_errorbar(data=sterile_zone, aes(species, median*100, ymin=lower__*100, ymax=upper__*100),                  width=0.05, color=\"black\", alpha=0.8, linewidth=0.5, show.legend=FALSE) +    theme(axis.text.x = element_text(angle = 45, vjust = 0.9, hjust=0.8)) +   scale_color_manual(values=sp_pal) + scale_fill_manual(values=sp_pal) +    ylab(\"Proportion colony reproductive\") + xlab(\"\")"},{"path":"https://marine-ecologist.github.io/reefspawn/articles/brms.html","id":"simulate-colonies","dir":"Articles","previous_headings":"","what":"2. Simulate colonies","title":"Bayesian models","text":"Combine vars get total output per colony * species (data.table predictions speed):","code":"library(data.table)  # Set number of posterior draws ndraws <- 5000  # Convert coralsize to data.table coralsize <- as.data.table(coralsize)  # Step 1: Max width per species maxwidth_dt <- coralsize[, .(maxwidth = max(width)), by = species]  # Step 2: Build species × width grid base_newdf <- CJ(   species = unique(coralsize$species),   width = seq(2, 200, 4) ) base_newdf <- merge(base_newdf, maxwidth_dt, by = \"species\")[width <= maxwidth][, maxwidth := NULL]  # Step 3: Repeat for draws newdf <- base_newdf[rep(1:.N, each = ndraws)][, draw := rep(1:ndraws, times = .N / ndraws)]  # Step 4: Posterior predictions for each model pp_polyp   <- posterior_predict(brm_polyp_density, newdata = base_newdf, ndraws = ndraws) pp_repro   <- posterior_predict(brm_probability, newdata = base_newdf, ndraws = ndraws) pp_oocytes <- posterior_predict(brm_fecundity, newdata = base_newdf, ndraws = ndraws)  # Step 5: Flatten predictions into long vector newdf[, polypdensity := as.numeric(pp_polyp)] newdf[, reproductive_probability := as.numeric(pp_repro)] newdf[, oocytes := as.numeric(pp_oocytes)]  # Step 6: Sample sterile zone proportions newdf[, sterile_proportion := sample_sterile_zone(species_vec = species, draw = \"random\")]  # Step 7: Calculate reproductive output newdf[, area := pi * (width / 2)^2] newdf[, colony_polyps := polypdensity * area * 10000] newdf[, reproductive_polyps := colony_polyps * sterile_proportion] newdf[, output := reproductive_polyps * oocytes * reproductive_probability]  # Step 8: Summarise posterior output summary_dt <- newdf[, .(   median.output = mean(output),   lower.ci.output = quantile(output, 0.2),   upper.ci.output = quantile(output, 0.8) ), by = .(species, width)]  # Step 9: Add growthform and factor levels summary_dt[, species := factor(species, levels = sp_order)] summary_dt[, growthform := fct_recode(species,                                       \"Tabular\"   = \"Acropora cytherea\",                                       \"Tabular\"   = \"Acropora hyacinthus\",                                       \"Branching\" = \"Acropora intermedia\",                                       \"Branching\" = \"Acropora robusta\",                                       \"Massive\"   = \"Goniastrea pectinata\",                                       \"Massive\"   = \"Goniastrea retiformis\",                                       \"Corymbose\" = \"Acropora nasuta\",                                       \"Corymbose\" = \"Acropora millepora\",                                       \"Corymbose\" = \"Acropora spathulata\",                                       \"Digitate\"  = \"Acropora cf. digitifera\",                                       \"Digitate\"  = \"Acropora humilis\" )]    ggplot() + theme_bw() +    geom_line(data=summary_dt, aes(width, median.output, color=species), linewidth=1.2) +    scale_y_continuous(labels = scales::comma) +   scale_color_manual(values=sp_pal) + scale_fill_manual(values=sp_pal) ggplot() +    theme_bw() +    facet_wrap(~growthform, scales = \"free_y\") +   geom_ribbon(data = summary_dt, aes(width, ymin = lower.ci.output, ymax = upper.ci.output, fill = species), alpha = 0.4) +    geom_line(data = summary_dt, aes(width, median.output, color = species)) +    scale_y_continuous(labels = scales::comma) +   scale_color_manual(values = sp_pal) +    scale_fill_manual(values = sp_pal) +   theme(legend.position = \"bottom\")"},{"path":"https://marine-ecologist.github.io/reefspawn/articles/overview.html","id":"quarto","dir":"Articles","previous_headings":"","what":"Quarto","title":"overview","text":"Quarto enables weave together content executable code finished document. learn Quarto see https://quarto.org.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/articles/overview.html","id":"running-code","dir":"Articles","previous_headings":"","what":"Running Code","title":"overview","text":"click Render button document generated includes content output embedded code. can embed code like : can add options executable code like echo: false option disables printing code (output displayed).","code":"1 + 1 [1] 2 [1] 4"},{"path":"https://marine-ecologist.github.io/reefspawn/articles/workflow.html","id":"simulate-reef-area","dir":"Articles","previous_headings":"","what":"1) Simulate reef area","title":"Reefspawn workflow","text":"simulate reef plot 16m long 8m wide (note: default crs (EPSG:3857) projected lon/lat degrees).","code":"library(reefspawn)  sf_plot <- setplot(16,8) # default EPSG:3857 16 x 8 m plot 128 [m^2]"},{"path":"https://marine-ecologist.github.io/reefspawn/articles/workflow.html","id":"simulate-coral-communities","dir":"Articles","previous_headings":"","what":"2) Simulate coral communities","title":"Reefspawn workflow","text":"Simulate coral communities 40% cover within 128 [m^2] plot. Communities structured 11 species across five different growthforms: tabular corals (Acropora cytherea, . hyacinthus), corymbose corals (. millepora, . nasuta, . spathulata), digitate corals (. humilis, . digitifera), branching corals (. intermedia, . robusta), massive corals (Goniastrea pectinata, G. retiformis). function builds coral communities based observed colony sizes Lizard Island 2009 2015 (~ 30 colonies 11 species, Madin et al 2023) simulates 40% cover reef. Community structure based pre-determined ratio growth forms (tabular = 0.7, digitate = 0.075, corymbose = 0.125, branching = 0.08, massive = 0.02) assigned across 11 species. exact coral cover stochastic sampled beta distribution (alpha=12, beta=4) vary ~40% cover running multiple simulations. plot = TRUE returns full summary paramterisation. details see ?reefspawn::simulate_communities()","code":"communities <- simulate_community(setplot = sf_plot,                                   coralcover=40,                                   size = coralsize,                                   ratiovar = 0.2,                                   alpha = 24,                                   beta = 8,                                   seed = 321,                                   plot = TRUE,                                   quiet = TRUE) TableGrob (3 x 1) \"arrange\": 3 grobs   z     cells    name            grob 1 1 (1-1,1-1) arrange gtable[arrange] 2 2 (2-2,1-1) arrange  gtable[layout] 3 3 (3-3,1-1) arrange gtable[arrange]"},{"path":"https://marine-ecologist.github.io/reefspawn/articles/workflow.html","id":"simulate-coral-populations","dir":"Articles","previous_headings":"","what":"3) Simulate coral populations","title":"Reefspawn workflow","text":"simulated community output (% cover 11 species), simulate_populations() takes output bayesian model predictions size distributions (based Lizard Island data) simulates populations fill percent cover species. function outputs either df - dataframe individals size distribution, sf simple features corresponding sizes coordinates within initial plot. coral size data included package coralsize can replaced updated additional data flexible parameterisation. spatial mapping sf uses species hierarchy approach determining likely spatial competitor initial population space, sets maximum overlap colonies random using normal distribution (max 90% overlap) simulate spatially realistic coral population. spatial coordinates colony determined using circle packing algorithm within initial plot using iterative pair-wise repulsion approach find non-overlapping colonies space. approach rapid (<2 mins) small plots (<100m^2) population densities <5000 colonies, rapidly saturates becomes time consuming number - large plots subsetting smaller plots (ideally using parallel approach) computationally less taxing. output spatially referenced details see ?reefspawn::simulate_populations()","code":"populations <- simulate_populations(setplot = sf_plot,                                     size = coralsize,                                     community = communities,                                     return=\"sf\",                                     ndraws = 2000,                                     seed = 321,                                     interactive=TRUE,                                     quiet=TRUE)   head(populations) Simple feature collection with 6 features and 11 fields Active geometry column: geometry Geometry type: POLYGON Dimension:     XY Bounding box:  xmin: 3.917155 ymin: 0.02768323 xmax: 13.12523 ymax: 5.654727 Projected CRS: WGS 84 / Pseudo-Mercator # A tibble: 6 × 13      id                    geometry species width    area cumulative_area aerial   <int>               <POLYGON [m]> <fct>   <dbl>   <dbl>           <dbl>  <dbl> 1     1 ((4.126517 0.1325715, 4.12… Acropo…  19.7 0.0305             305. 2.68e5 2     2 ((11.75122 5.558723, 11.74… Acropo…  17.3 0.0236             541. 2.68e5 3     3 ((5.179833 1.635097, 5.178… Acropo…  11.1 0.00972            638. 2.68e5 4     4 ((4.958945 4.664497, 4.956… Acropo…  13.8 0.0150             788. 2.68e5 5     5 ((13.12523 5.398767, 13.12… Acropo…  15.3 0.0184             972. 2.68e5 6     6 ((5.125676 5.488925, 5.123… Acropo…  12.6 0.0124            1096. 2.68e5 # ℹ 6 more variables: coords <POINT [m]>, zindex_id <int>, species.id <chr>, #   x <dbl>, y <dbl>, overlaparea <dbl>"},{"path":"https://marine-ecologist.github.io/reefspawn/articles/workflow.html","id":"map-coral-populations","dir":"Articles","previous_headings":"","what":"4) Map coral populations","title":"Reefspawn workflow","text":"map_populations visualises output simulate_populations XY space. sum(populations$area) return combined area corals, (sum(populations$area) / .numeric(sum(st_area(sf_plot)))) *100 percent cover. details see ?reefspawn::map_populations()","code":"map_populations(setplot = sf_plot,                 populations = populations,                 interactive = FALSE,                 webgl = TRUE)"},{"path":"https://marine-ecologist.github.io/reefspawn/articles/workflow.html","id":"simulate-spawning","dir":"Articles","previous_headings":"","what":"5) Simulate spawning","title":"Reefspawn workflow","text":"simulate_spawning takes colonies populations parameterises per colony output oocytes based Bayesian models fit data Lizard Island (Álvarez-Noriega et al 2016). function uses posterior_predict brms models sample draws posterior predictive distribution observed data (.e. adds model uncertainty + residual (observation-level) noise). colony, function predicts total number polyps, proportion polyps reproductive (.e. within sterile zone growth margins), number oocytes per polyp, probability colonies reproductive (binomial). Output=P⋅(⋅10,000)⋅S⋅O⋅R Output = P \\cdot (\\cdot 10{,}000) \\cdot S \\cdot O \\cdot R $:$'$- \\( P \\) = polyp density (polyps per cm²)$’ $- \\( \\) = colony area m²$'$- \\( S \\) = sterile proportion$‘$- \\( O \\) = oocytes per reproductive polyp$'$- \\( R \\) = reproductive probability$’ See brm page exact paramterisation code models. model fits included package (brm_fecundity, brm_probability, brm_polyp_density, brm_sizedistribution) can flexibly paramaterised updated data. details see ?reefspawn::simulate_spawning()  run large datasets parallel processing / mulitcore use return=\"df\"instead return=\"sf\" bypass sf functionality. Example hectare plot returns reproductive outputs 96,490 colonies 38 seconds","code":"reproductiveoutput <- simulate_spawning(populations = populations,                                         setplot = sf_plot,                                         seed = 1001,                                         quiet = FALSE,                                         plot = TRUE) [1] \"2.892 sec elapsed - simulate_populations()\" [1] \"22,874,275 - total reproductive output\" [1] \"178,705 - reproductive output per m2\" TableGrob (2 x 1) \"arrange\": 2 grobs   z     cells    name           grob 1 1 (1-1,1-1) arrange gtable[layout] 2 2 (2-2,1-1) arrange gtable[layout] sf_plot_large <- setplot(100,100) 100 x 100 m plot 10000 [m^2] hectare_output <- simulate_community(setplot = sf_plot_large,                                       coralcover=40,                                       size = coralsize |> dplyr::filter(year==2011),                                       seed = 321,                                       plot = FALSE,                                       quiet = TRUE) %>%    simulate_populations(community = .,                         seed = 321,                         return=\"df\") %>%   simulate_spawning(populations = .,                      seed = 321)   hectare_summary <- hectare_output |>   dplyr::group_by(species) |>   dplyr::summarise(output = sum(output)) |>   dplyr::mutate(output = format(output, big.mark = \",\", scientific = FALSE)) %>%   dplyr::bind_rows(     dplyr::summarise(., species = \"Total\", output = format(sum(as.numeric(gsub(\",\", \"\", output))), big.mark = \",\"))   )   hectare_summary |> print(n=12) # A tibble: 11 × 2    species               output    <chr>                 <chr>  1 Acropora cytherea     \"  740,055,247,996\"  2 Acropora humilis      \"  860,564,925,512\"  3 Acropora hyacinthus   \"1,195,120,571,656\"  4 Acropora intermedia   \"   12,919,122,014\"  5 Acropora millepora    \"  958,865,053,429\"  6 Acropora nasuta       \"  649,821,757,716\"  7 Acropora robusta      \"  293,451,466,713\"  8 Acropora spathulata   \"  570,747,316,047\"  9 Goniastrea pectinata  \"8,927,909,724,634\" 10 Goniastrea retiformis \"  180,496,212,782\" 11 Total                 \"1.438995e+13\""},{"path":"https://marine-ecologist.github.io/reefspawn/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"George Roff. Author, maintainer.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Roff G (2025). reefspawn: Community scale simulations coral reproductive output. R package version 0.0.0.9000, https://marine-ecologist.github.io/reefspawn.","code":"@Manual{,   title = {reefspawn: Community scale simulations of coral reproductive output},   author = {George Roff},   year = {2025},   note = {R package version 0.0.0.9000},   url = {https://marine-ecologist.github.io/reefspawn}, }"},{"path":"https://marine-ecologist.github.io/reefspawn/index.html","id":"reefspawn","dir":"","previous_headings":"","what":"reefspawn Project","title":"reefspawn Project","text":"R package simulating coral spawning ```{r} #| eval: false #| include: true remotes::install_github(“http://marine-ecologist.github.io/reefspawn/”) ```","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/beta_dist.html","id":null,"dir":"Reference","previous_headings":"","what":"Sample Beta Distribution and Return Density — beta_dist","title":"Sample Beta Distribution and Return Density — beta_dist","text":"Generates beta distribution based specified mean variance, returns density estimate data frame.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/beta_dist.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Sample Beta Distribution and Return Density — beta_dist","text":"","code":"beta_dist(mean, variance, samples = 1000, variance_factor = 0.1)"},{"path":"https://marine-ecologist.github.io/reefspawn/reference/beta_dist.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Sample Beta Distribution and Return Density — beta_dist","text":"mean Numeric scalar. Desired mean beta distribution. Must 0 1 (exclusive). variance Numeric scalar. Desired variance beta distribution. constrained variance_factor. samples Integer. Number samples draw beta distribution. Default 1000. variance_factor Numeric scalar. Limits allowed variance fraction theoretical maximum variance. Default 0.1.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/beta_dist.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Sample Beta Distribution and Return Density — beta_dist","text":"tibble columns x y representing smoothed density estimate sampled beta distribution.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/beta_dist.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Sample Beta Distribution and Return Density — beta_dist","text":"shape (.e., skew peak) Beta distribution driven ratio alpha / (alpha + beta) (controls mean), sum alpha + beta (controls concentration/peakedness).","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/beta_dist.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Sample Beta Distribution and Return Density — beta_dist","text":"","code":"beta_dist(mean = 0.4, variance = 0.01) #> # A tibble: 512 × 2 #>         x        y #>     <dbl>    <dbl> #>  1 0.0891 0.000358 #>  2 0.0905 0.000431 #>  3 0.0918 0.000517 #>  4 0.0931 0.000620 #>  5 0.0944 0.000743 #>  6 0.0957 0.000886 #>  7 0.0971 0.00105  #>  8 0.0984 0.00124  #>  9 0.0997 0.00147  #> 10 0.101  0.00174  #> # ℹ 502 more rows"},{"path":"https://marine-ecologist.github.io/reefspawn/reference/coralsim.html","id":null,"dir":"Reference","previous_headings":"","what":"Simulate Coral Colonies in a Polygon — coralsim","title":"Simulate Coral Colonies in a Polygon — coralsim","text":"function simulates coral cover colony distribution within specified polygon. generates species-specific ratios, predicts coral colony sizes, uses spatial algorithms distribute colonies without overlap.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/coralsim.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Simulate Coral Colonies in a Polygon — coralsim","text":"","code":"coralsim(input, set_overlap, raw = FALSE, seed = NULL, crs = 3857, ...)"},{"path":"https://marine-ecologist.github.io/reefspawn/reference/coralsim.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Simulate Coral Colonies in a Polygon — coralsim","text":"input sf polygon object defining plot area. set_overlap percentage overlap setting colonies (randomized). raw Logical. TRUE, returns raw data instead spatial polygons. seed optional seed value reproducibility. crs coordinate reference system (default EPSG:3857). ... Additional arguments passed underlying functions.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/coralsim.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Simulate Coral Colonies in a Polygon — coralsim","text":"sf object containing non-overlapping coral colony polygons, raw data raw = TRUE.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/fecundity.html","id":null,"dir":"Reference","previous_headings":"","what":"Load and preprocess coral fecundity and size data — fecundity","title":"Load and preprocess coral fecundity and size data — fecundity","text":"Loads fecundity.csv size_structure.csv inst/extdata directory, computes derived width area, assigns species-level growthforms.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/fecundity.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Load and preprocess coral fecundity and size data — fecundity","text":"","code":"fecundity"},{"path":"https://marine-ecologist.github.io/reefspawn/reference/fecundity.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Load and preprocess coral fecundity and size data — fecundity","text":"object class data.frame 32436 rows 13 columns.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/fecundity.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Load and preprocess coral fecundity and size data — fecundity","text":"Two data frames: fecundity: colony area, width, reproductive status coralsize: species, width, assigned growthform","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/fecundity.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Load and preprocess coral fecundity and size data — fecundity","text":"fecundity includes colony-level reproductive data. coralsize contains colony size structure species, growthform classification. Width computed sqrt(area_cm2 / pi) * 2. Growthforms assigned using fct_recode() based species identity.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/fecundity.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Load and preprocess coral fecundity and size data — fecundity","text":"","code":"head(fecundity) #>         id year observer              species spp colony branch polyp eggs #> 1 F10_GP01 2016       CY Goniastrea pectinata  GP      1     NA     4    0 #> 2 F10_GP01 2016       CY Goniastrea pectinata  GP      1     NA     2    0 #> 3 F10_GP01 2016       CY Goniastrea pectinata  GP      1     NA     1    0 #> 4 F10_GP01 2016       CY Goniastrea pectinata  GP      1     NA     3    0 #> 5 F10_GP01 2016       CY Goniastrea pectinata  GP      1     NA     6    0 #> 6 F10_GP01 2016       CY Goniastrea pectinata  GP      1     NA     5    0 #>   area_cm2 reproductive       area    width #> 1  43.5185            0 0.00435185 7.443754 #> 2  43.5185            0 0.00435185 7.443754 #> 3  43.5185            0 0.00435185 7.443754 #> 4  43.5185            0 0.00435185 7.443754 #> 5  43.5185            0 0.00435185 7.443754 #> 6  43.5185            0 0.00435185 7.443754 head(coralsize) #>   spp               species year  area_cm2     width growthform #> 1  GR Goniastrea retiformis 2010  12.27814  3.953861    Massive #> 2  GR Goniastrea retiformis 2010  91.45160 10.790727    Massive #> 3  AH   Acropora hyacinthus 2010  19.80796  5.021979    Tabular #> 4  AL   Acropora spathulata 2010 210.93766 16.388233  Corymbose #> 5  GR Goniastrea retiformis 2010 330.54733 20.515017    Massive #> 6  AS      Acropora humilis 2010 113.80219 12.037335   Digitate"},{"path":"https://marine-ecologist.github.io/reefspawn/reference/map_populations.html","id":null,"dir":"Reference","previous_headings":"","what":"Map Coral Populations with Species Coloring — map_populations","title":"Map Coral Populations with Species Coloring — map_populations","text":"Plots spatial map coral populations setplot base layer using tmap. Species color-coded customizable palette, output can either interactive (web) static. Optionally enables disables WebGL 3D rendering interactive view.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/map_populations.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Map Coral Populations with Species Coloring — map_populations","text":"","code":"map_populations(setplot, populations, interactive = TRUE, webgl = TRUE)"},{"path":"https://marine-ecologist.github.io/reefspawn/reference/map_populations.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Map Coral Populations with Species Coloring — map_populations","text":"setplot sf SpatVector object representing background plot layer (e.g. reef tiles). populations sf object point geometries species column map. interactive Logical; TRUE, map shown interactive web view. FALSE, renders static plot. webgl Logical; interactive = TRUE, sets WebGL rendering mode tm_view().","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/map_populations.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Map Coral Populations with Species Coloring — map_populations","text":"tmap object","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/map_populations.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Map Coral Populations with Species Coloring — map_populations","text":"","code":"if (FALSE) { # \\dontrun{ grid <- setplot(10, 5) map_populations(setplot = grid, populations = coral_points, interactive = TRUE, webgl = FALSE) } # }"},{"path":"https://marine-ecologist.github.io/reefspawn/reference/pipe.html","id":null,"dir":"Reference","previous_headings":"","what":"Pipe operator — %>%","title":"Pipe operator — %>%","text":"See magrittr::%>% details.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/pipe.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Pipe operator — %>%","text":"","code":"lhs %>% rhs"},{"path":"https://marine-ecologist.github.io/reefspawn/reference/pipe.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Pipe operator — %>%","text":"lhs value magrittr placeholder. rhs function call using magrittr semantics.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/pipe.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Pipe operator — %>%","text":"result calling rhs(lhs).","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/polyp_density_data.html","id":null,"dir":"Reference","previous_headings":"","what":"Load and augment coral polyp density data — polyp_density_data","title":"Load and augment coral polyp density data — polyp_density_data","text":"Loads polyp_density.csv, adds estimated entry Acropora millepora based similar species (. nasuta . spathulata), assigns growthform classifications.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/polyp_density_data.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Load and augment coral polyp density data — polyp_density_data","text":"","code":"polyp_density_data"},{"path":"https://marine-ecologist.github.io/reefspawn/reference/polyp_density_data.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Load and augment coral polyp density data — polyp_density_data","text":"object class data.frame 45 rows 7 columns.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/polyp_density_data.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Load and augment coral polyp density data — polyp_density_data","text":"polyp_density_data data frame species assigned growthforms.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/polyp_density_data.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Load and augment coral polyp density data — polyp_density_data","text":"Acropora millepora present original dataset. estimate , data . nasuta . spathulata duplicated relabeled. new spp code \"\" assigned added entries. Growthforms recoded using fct_recode() based species name.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/polyp_density_data.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Load and augment coral polyp density data — polyp_density_data","text":"","code":"head(polyp_density_data) #>         id spp              species cm2 polyps polyps_cm2 growthform #> 1      764  AC    Acropora cytherea  16   1268    79.2500    Tabular #> 2      663  AH  Acropora hyacinthus  16   1355    84.6875    Tabular #> 3      719  AH  Acropora hyacinthus  16   1212    75.7500    Tabular #> 4 large G.  GP Goniastrea pectinata  16     90     5.6250    Massive #> 5      769  GP Goniastrea pectinata  16     57     3.5625    Massive #> 6      733  GP Goniastrea pectinata  16    112     7.0000    Massive"},{"path":"https://marine-ecologist.github.io/reefspawn/reference/predict_colony_width.html","id":null,"dir":"Reference","previous_headings":"","what":"Predict colony width using posterior predict (lognormal model) — predict_colony_width","title":"Predict colony width using posterior predict (lognormal model) — predict_colony_width","text":"Predict colony width using posterior predict (lognormal model)","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/predict_colony_width.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Predict colony width using posterior predict (lognormal model) — predict_colony_width","text":"","code":"predict_colony_width(newdata, draws, draw_id = 1)"},{"path":"https://marine-ecologist.github.io/reefspawn/reference/predict_colony_width.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Predict colony width using posterior predict (lognormal model) — predict_colony_width","text":"newdata data.frame species column. draws Posterior draws posterior_coeffs_sizedistribution. draw_id Integer index draw use.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/predict_colony_width.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Predict colony width using posterior predict (lognormal model) — predict_colony_width","text":"Numeric vector predicted widths.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/predict_colony_width.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Predict colony width using posterior predict (lognormal model) — predict_colony_width","text":"","code":"if (FALSE) { # \\dontrun{ newdata <- data.frame(species = c(\"Acropora\", \"Porites\")) predict_colony_width(newdata, posterior_coeffs_sizedistribution, draw_id = 10) } # }"},{"path":"https://marine-ecologist.github.io/reefspawn/reference/predict_oocytes.html","id":null,"dir":"Reference","previous_headings":"","what":"Predict oocytes per reproductive polyp using posterior predict (ZIP model) — predict_oocytes","title":"Predict oocytes per reproductive polyp using posterior predict (ZIP model) — predict_oocytes","text":"Predict oocytes per reproductive polyp using posterior predict (ZIP model)","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/predict_oocytes.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Predict oocytes per reproductive polyp using posterior predict (ZIP model) — predict_oocytes","text":"","code":"predict_oocytes(newdata, draws, draw_id = 1)"},{"path":"https://marine-ecologist.github.io/reefspawn/reference/predict_oocytes.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Predict oocytes per reproductive polyp using posterior predict (ZIP model) — predict_oocytes","text":"newdata data.frame species width columns. draws Posterior draws posterior_coeffs_oocyte_output. draw_id Integer index draw use.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/predict_oocytes.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Predict oocytes per reproductive polyp using posterior predict (ZIP model) — predict_oocytes","text":"Numeric vector expected counts.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/predict_oocytes.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Predict oocytes per reproductive polyp using posterior predict (ZIP model) — predict_oocytes","text":"","code":"if (FALSE) { # \\dontrun{ newdata <- expand.grid(species = levels(coralsize$species), width = seq(0,50,5)) newdata$oocytes <- predict_oocytes(newdata, posterior_coeffs_oocyte_output, draw_id = 100) } # }"},{"path":"https://marine-ecologist.github.io/reefspawn/reference/predict_polyp_density.html","id":null,"dir":"Reference","previous_headings":"","what":"Predict polyp density per colony using posterior predict (gaussian model) — predict_polyp_density","title":"Predict polyp density per colony using posterior predict (gaussian model) — predict_polyp_density","text":"Predict polyp density per colony using posterior predict (gaussian model)","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/predict_polyp_density.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Predict polyp density per colony using posterior predict (gaussian model) — predict_polyp_density","text":"","code":"predict_polyp_density(newdata, draws, draw_id = 1)"},{"path":"https://marine-ecologist.github.io/reefspawn/reference/predict_polyp_density.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Predict polyp density per colony using posterior predict (gaussian model) — predict_polyp_density","text":"newdata data.frame species column. draws Posterior draws posterior_coeffs_polypdensity. draw_id Integer index draw use.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/predict_polyp_density.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Predict polyp density per colony using posterior predict (gaussian model) — predict_polyp_density","text":"Numeric vector predicted polyp densities.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/predict_polyp_density.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Predict polyp density per colony using posterior predict (gaussian model) — predict_polyp_density","text":"","code":"if (FALSE) { # \\dontrun{ newdata <- data.frame(species = c(\"Acropora\", \"Porites\")) predict_polyp_density(newdata, posterior_coeffs_polypdensity, draw_id = 5) } # }"},{"path":"https://marine-ecologist.github.io/reefspawn/reference/predict_repro_prob.html","id":null,"dir":"Reference","previous_headings":"","what":"Predict reproductive probability using posterior predict (bernoulli model) — predict_repro_prob","title":"Predict reproductive probability using posterior predict (bernoulli model) — predict_repro_prob","text":"Predict reproductive probability using posterior predict (bernoulli model)","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/predict_repro_prob.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Predict reproductive probability using posterior predict (bernoulli model) — predict_repro_prob","text":"","code":"predict_repro_prob(newdata, draws, draw_id = 1)"},{"path":"https://marine-ecologist.github.io/reefspawn/reference/predict_repro_prob.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Predict reproductive probability using posterior predict (bernoulli model) — predict_repro_prob","text":"newdata data.frame species width columns. draws Posterior draws posterior_coeffs_reproductive_probability. draw_id Integer index draw use.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/predict_repro_prob.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Predict reproductive probability using posterior predict (bernoulli model) — predict_repro_prob","text":"Numeric vector probabilities.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/predict_repro_prob.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Predict reproductive probability using posterior predict (bernoulli model) — predict_repro_prob","text":"","code":"if (FALSE) { # \\dontrun{ newdata <- expand.grid(species = levels(coralsize$species), width = seq(0,50,5)) newdata$reproductive_probability <- predict_repro_prob(newdata, posterior_coeffs_reproductive_probability, draw_id = 20) } # }"},{"path":"https://marine-ecologist.github.io/reefspawn/reference/reefspawn-package.html","id":null,"dir":"Reference","previous_headings":"","what":"reefspawn: Community scale simulations of coral reproductive output — reefspawn-package","title":"reefspawn: Community scale simulations of coral reproductive output — reefspawn-package","text":"Functions scale coral reproductive output spawning Indo-Pacific corals","code":""},{"path":[]},{"path":"https://marine-ecologist.github.io/reefspawn/reference/reefspawn-package.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"reefspawn: Community scale simulations of coral reproductive output — reefspawn-package","text":"Maintainer: George Roff george.roff@csiro.au","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/sample_sterile_zone.html","id":null,"dir":"Reference","previous_headings":"","what":"Sample Sterile Zone Proportions by Species — sample_sterile_zone","title":"Sample Sterile Zone Proportions by Species — sample_sterile_zone","text":"Returns vector sterile zone proportions (.e., proportion coral colony lies outside sterile zone), sampled lower, median, upper estimates per species.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/sample_sterile_zone.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Sample Sterile Zone Proportions by Species — sample_sterile_zone","text":"","code":"sample_sterile_zone(   species_vec,   width_vec = NULL,   draw = c(\"random\", \"median\", \"lower\", \"upper\") )"},{"path":"https://marine-ecologist.github.io/reefspawn/reference/sample_sterile_zone.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Sample Sterile Zone Proportions by Species — sample_sterile_zone","text":"species_vec character vector species names. width_vec Optional numeric vector colony widths (ignored; reserved future use). draw Character, one \"random\" (default), \"median\", \"lower\", \"upper\". Determines select sterile proportion value.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/sample_sterile_zone.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Sample Sterile Zone Proportions by Species — sample_sterile_zone","text":"numeric vector sampled sterile zone proportions, length species_vec.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/sample_sterile_zone.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Sample Sterile Zone Proportions by Species — sample_sterile_zone","text":"","code":"if (FALSE) { # \\dontrun{ species <- c(\"Acropora hyacinthus\", \"Acropora millepora\", \"Goniastrea retiformis\") sample_sterile_zone(species, draw = \"random\") } # }"},{"path":"https://marine-ecologist.github.io/reefspawn/reference/setplot.html","id":null,"dir":"Reference","previous_headings":"","what":"Generate a Rectangular sf Plot Grid — setplot","title":"Generate a Rectangular sf Plot Grid — setplot","text":"Creates simple rectangular spatial plot specified length width meters, returns 1m x 1m sf grid overlaid area. CRS EPSG:3857 default.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/setplot.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Generate a Rectangular sf Plot Grid — setplot","text":"","code":"setplot(length, width, crs = 3857)"},{"path":"https://marine-ecologist.github.io/reefspawn/reference/setplot.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Generate a Rectangular sf Plot Grid — setplot","text":"length Numeric. Length plot meters (X-dimension). width Numeric. Width plot meters (Y-dimension). crs Integer. Coordinate Reference System (default = 3857).","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/setplot.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Generate a Rectangular sf Plot Grid — setplot","text":"sf object representing grid 1m x 1m cells covering defined plot.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/setplot.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Generate a Rectangular sf Plot Grid — setplot","text":"","code":"grid <- setplot(10, 5) #> 10 x 5 m plot #> 50 [m^2] plot(grid)"},{"path":"https://marine-ecologist.github.io/reefspawn/reference/simulate_community.html","id":null,"dir":"Reference","previous_headings":"","what":"Simulate Coral Community Composition — simulate_community","title":"Simulate Coral Community Composition — simulate_community","text":"Generates simulated coral community composition allocating aerial cover species based user-defined morphological ratios total coral cover estimate, optionally drawn beta distribution. Optionally plots species size distributions assigned ratios.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/simulate_community.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Simulate Coral Community Composition — simulate_community","text":"","code":"simulate_community(   setplot,   size,   ratio,   ratiovar = 0.2,   coralcover = NULL,   distribution = \"beta\",   alpha = 12,   beta = 4,   seed = NULL,   quiet = TRUE,   plot = FALSE,   ... )"},{"path":"https://marine-ecologist.github.io/reefspawn/reference/simulate_community.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Simulate Coral Community Composition — simulate_community","text":"setplot sf polygon object representing plot area (used calculate total area). size data frame columns species area_cm2 containing size distributions. ratio named numeric vector proportions assigned growth form (names must : \"Tabular\", \"Branching\", \"Corymbose\", \"Digitate\", \"Massive\"). ratiovar Numeric. Proportional noise added growthform's ratio. Default 0.2. coralcover Numeric. Mean coral cover percentage (0–100). distribution = \"beta\", mean used sample actual coral cover. distribution Character. \"beta\", coral cover sampled beta distribution. Set NULL use coralcover directly. alpha Shape parameter α beta distribution (default = 12). beta Shape parameter β beta distribution (default = 4). seed Optional. integer seed reproducible randomization. quiet verbose plot Logical. TRUE, generates diagnostic plots simulation distributions. ... Additional arguments (currently ignored).","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/simulate_community.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Simulate Coral Community Composition — simulate_community","text":"data frame (tibble) columns species, growthform, ratio, cover, aerial area per species cm².","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/simulate_community.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Simulate Coral Community Composition — simulate_community","text":"","code":"if (FALSE) { # \\dontrun{ ratios <- c(Tabular = 0.2, Branching = 0.2, Corymbose = 0.2, Digitate = 0.2, Massive = 0.2) simulate_community(setplot = my_sf_plot, size = coral_size_data, ratio = ratios, coralcover = 30) } # }"},{"path":"https://marine-ecologist.github.io/reefspawn/reference/simulate_populations.html","id":null,"dir":"Reference","previous_headings":"","what":"Simulate Coral Population Layout from Posterior Predictions — simulate_populations","title":"Simulate Coral Population Layout from Posterior Predictions — simulate_populations","text":"Generates spatial coral population layout drawing brms-fit model colony sizes, filtering match aerial coverage constraints, laying colonies optional circle packing.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/simulate_populations.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Simulate Coral Population Layout from Posterior Predictions — simulate_populations","text":"","code":"simulate_populations(   setplot,   size,   community,   brms = posterior_coeffs_sizedistribution,   return = \"df\",   algorithm = \"repel\",   ndraws = 20000,   seed = NULL,   quiet = TRUE,   plot = FALSE,   interactive = FALSE )"},{"path":"https://marine-ecologist.github.io/reefspawn/reference/simulate_populations.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Simulate Coral Population Layout from Posterior Predictions — simulate_populations","text":"setplot sf polygon representing area colonies positioned. size data frame containing species size distribution (area width). community data frame containing species aerial (m²) coverage values. brms brmsfit object used generate posterior predictions colony size species. return Character. \"df\" returns raw colony list; \"sf\" returns spatial polygons. Default: \"df\". algorithm Character. \"repel\" (default) \"progressive\" — determines circle packing layout method. ndraws Integer. Number posterior predictive draws simulate. Default: 50000. seed Optional integer reproducibility sampling layout. quiet verbose plot Logical. TRUE, renders tmap plot resulting layout. Default: FALSE. interactive Logical. TRUE, renders tmap interactive plot resulting layout. Default: FALSE.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/simulate_populations.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Simulate Coral Population Layout from Posterior Predictions — simulate_populations","text":"Either data frame simulated colonies (df) sf object spatial polygons (sf) depending return.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/simulate_populations.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Simulate Coral Population Layout from Posterior Predictions — simulate_populations","text":"Species names harmonized using fct_recode. Aerial coverage enforced using cumulative area filtering. circleRepelLayout() uses iterative physics-based algorithm, circleProgressiveLayout() faster approximate. Coordinates assigned using sf::st_sample() radii scaled match overlap assumptions.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/simulate_populations.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Simulate Coral Population Layout from Posterior Predictions — simulate_populations","text":"","code":"if (FALSE) { # \\dontrun{ simulate_populations(setplot = myreef_sf, size = colony_data, community = community_df,                      brms = size_model, return = \"sf\", algorithm = \"repel\", seed = 42, plot = TRUE) } # }"},{"path":"https://marine-ecologist.github.io/reefspawn/reference/simulate_spawning.html","id":null,"dir":"Reference","previous_headings":"","what":"Simulate Spawning Output per Coral Colony — simulate_spawning","title":"Simulate Spawning Output per Coral Colony — simulate_spawning","text":"Combines multiple Bayesian models estimate reproductive output (number oocytes) colony population. Uses polyp density, reproductive probability, sterile zone proportion, oocytes per polyp.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/simulate_spawning.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Simulate Spawning Output per Coral Colony — simulate_spawning","text":"","code":"simulate_spawning(populations, setplot, seed, quiet = TRUE, plot = FALSE)"},{"path":"https://marine-ecologist.github.io/reefspawn/reference/simulate_spawning.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Simulate Spawning Output per Coral Colony — simulate_spawning","text":"populations sf object containing colony data species, width, area columns. setplot setplot area seed setseed. quiet verbose plot plot output?","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/simulate_spawning.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Simulate Spawning Output per Coral Colony — simulate_spawning","text":"modified populations sf object added columns: polypdensity: Predicted polyps per cm² repro_prob: Probability reproductive sterile_proportion: Proportion outside sterile zone oocytes: Oocytes per reproductive polyp colony_polyps: Total number polyps per colony reproductive_polyps: Number reproductive polyps sterile_polyps: Number sterile polyps output: Total reproductive output (reproductive polyps × oocytes)","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/sp_order.html","id":null,"dir":"Reference","previous_headings":"","what":"Load and preprocess coral fecundity and size data — sp_order","title":"Load and preprocess coral fecundity and size data — sp_order","text":"Loads fecundity.csv size_structure.csv inst/extdata directory, computes derived width area, assigns species-level growthforms.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/sp_order.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Load and preprocess coral fecundity and size data — sp_order","text":"","code":"sp_order"},{"path":"https://marine-ecologist.github.io/reefspawn/reference/sp_order.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Load and preprocess coral fecundity and size data — sp_order","text":"object class character length 11.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/sp_order.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Load and preprocess coral fecundity and size data — sp_order","text":"Two data frames: fecundity: colony area, width, reproductive status coralsize: species, width, assigned growthform","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/sp_order.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Load and preprocess coral fecundity and size data — sp_order","text":"fecundity includes colony-level reproductive data. coralsize contains colony size structure species, growthform classification. Width computed sqrt(area_cm2 / pi) * 2. Growthforms assigned using fct_recode() based species identity.","code":""},{"path":"https://marine-ecologist.github.io/reefspawn/reference/sp_order.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Load and preprocess coral fecundity and size data — sp_order","text":"","code":"if (FALSE) { # \\dontrun{ head(fecundity) head(coralsize) } # }"}]
