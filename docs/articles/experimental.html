<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Experimental results • reefspawn</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="experimental_files/libs/quarto-html/popper.min.js"></script><script src="experimental_files/libs/quarto-html/tippy.umd.min.js"></script><link href="experimental_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="experimental_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="experimental_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="experimental_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="experimental_files/libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="experimental_files/libs/datatables-binding-0.33/datatables.js"></script><link href="experimental_files/libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="experimental_files/libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<link href="experimental_files/libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="experimental_files/libs/crosstalk-1.2.1/js/crosstalk.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Experimental results">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">reefspawn</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/workflow.html">1. Reefspawn Workflow</a></li>
    <li><a class="dropdown-item" href="../articles/brms.html">2. Model parameterisation</a></li>
    <li><a class="dropdown-item" href="../articles/experimental.html">3. Experimental results</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/marine-ecologist/reefspawn"><span class="fa fa-github"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Experimental results</h1>





      <div class="d-none name"><code></code></div>
    </div>






    <div class="cell">
<style>
  code, pre {
    font-size: 65%;
    color:darkgrey;
  }
</style>
</div>
<section class="section level2"><h2 id="bayesian-model-outputs">bayesian model outputs<a class="anchor" aria-label="anchor" href="#bayesian-model-outputs"></a>
</h2>
<section class="level2"><h3 id="oocyte-diameter">Oocyte diameter<a class="anchor" aria-label="anchor" href="#oocyte-diameter"></a>
</h3>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#| class-source: fold-hide</span></span>
<span><span class="co">#| message: false</span></span>
<span><span class="co">#| warning: false</span></span>
<span><span class="co">#| fig-width: 9.5</span></span>
<span><span class="co">#| fig-height: 5</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sfirke/janitor" class="external-link">janitor</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org" class="external-link">readxl</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paul-buerkner/brms" class="external-link">brms</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://marine-ecologist.github.io/reefspawn">reefspawn</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">egg_diameter_output</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span><span class="st">"/Users/rof011/reefspawn/code/SurvExpData.xlsx"</span>, sheet <span class="op">=</span> <span class="st">"ReprodOutput"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/clean_names.html" class="external-link">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span></span>
<span>    area <span class="op">=</span> <span class="va">colony_size_cm2</span>,</span>
<span>    egg_cover <span class="op">=</span> <span class="va">egg_percent_cover_jar</span>,</span>
<span>    egg_depth <span class="op">=</span> <span class="va">egg_layer_tickness_mm</span>,</span>
<span>    egg_diameter <span class="op">=</span> <span class="va">mean_egg_diameter_um</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    egg_diameter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">egg_diameter</span><span class="op">)</span>,</span>
<span>    treatment <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">treatment</span>, <span class="st">"SURV"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"impacted"</span>,</span>
<span>      <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">treatment</span>, <span class="st">"NORM"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"unimpacted"</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">treatment</span>, <span class="va">species</span>, <span class="va">egg_diameter</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html" class="external-link">drop_na</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">species</span>, <span class="st">"_"</span>, <span class="va">treatment</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit model including species</span></span>
<span><span class="co"># fm_egg_size &lt;- brms::brm(</span></span>
<span><span class="co">#   egg_diameter ~ treatment * species,</span></span>
<span><span class="co">#   data = egg_diameter_output,</span></span>
<span><span class="co">#   cores = 10,</span></span>
<span><span class="co">#   chains = 4,</span></span>
<span><span class="co">#   iter = 6000</span></span>
<span><span class="co"># )</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># saveRDS(fm_egg_size, "/Users/rof011/reefspawn/code/fm_egg_size.rds")</span></span>
<span></span>
<span><span class="va">fm_egg_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"/Users/rof011/reefspawn/code/fm_egg_size.rds"</span><span class="op">)</span></span>
<span>        </span>
<span><span class="co"># Fitted posterior summaries</span></span>
<span><span class="va">fitted_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://geobosh.github.io/fGarchDoc/reference/methods-fitted.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">fm_egg_size</span>, scale <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">egg_diameter_output</span> <span class="op">&lt;-</span> <span class="va">egg_diameter_output</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    predicted <span class="op">=</span> <span class="va">fitted_vals</span><span class="op">[</span>, <span class="st">"Estimate"</span><span class="op">]</span>,</span>
<span>    lower <span class="op">=</span> <span class="va">fitted_vals</span><span class="op">[</span>, <span class="st">"Q2.5"</span><span class="op">]</span>,</span>
<span>    upper <span class="op">=</span> <span class="va">fitted_vals</span><span class="op">[</span>, <span class="st">"Q97.5"</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Summarise for model overlay</span></span>
<span><span class="va">egg_diameter_summary</span> <span class="op">&lt;-</span> <span class="va">egg_diameter_output</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">treatment</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    predicted <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">predicted</span><span class="op">)</span>,</span>
<span>    lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">lower</span><span class="op">)</span>,</span>
<span>    upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">upper</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">species</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">egg_diameter_output</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">treatment</span>, y <span class="op">=</span> <span class="va">egg_diameter</span>, fill <span class="op">=</span> <span class="va">treatment</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"grey50"</span>, scale <span class="op">=</span> <span class="st">"width"</span>, alpha <span class="op">=</span> <span class="fl">0.6</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">egg_diameter_output</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">treatment</span>, y <span class="op">=</span> <span class="va">egg_diameter</span>, fill <span class="op">=</span> <span class="va">treatment</span><span class="op">)</span>,</span>
<span>    width <span class="op">=</span> <span class="fl">0.05</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">egg_diameter_summary</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">treatment</span>, fill <span class="op">=</span> <span class="va">treatment</span>,</span>
<span>        lower <span class="op">=</span> <span class="va">lower</span>, upper <span class="op">=</span> <span class="va">upper</span>,</span>
<span>        middle <span class="op">=</span> <span class="va">predicted</span>, ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span><span class="op">)</span>,</span>
<span>    stat <span class="op">=</span> <span class="st">"identity"</span>, width <span class="op">=</span> <span class="fl">0.2</span>, alpha <span class="op">=</span> <span class="fl">0.4</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Egg size (µm)"</span>, title <span class="op">=</span> <span class="st">"Egg size by Treatment"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"navajowhite2"</span>, <span class="st">"paleturquoise"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1000</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</details><div class="cell-output-display">
<div>
<figure><p><img src="experimental_files/figure-html/unnamed-chunk-1-1.png" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">colony_area_output</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span><span class="st">"/Users/rof011/reefspawn/code/SurvExpData.xlsx"</span>, sheet <span class="op">=</span> <span class="st">"ReprodOutput"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/clean_names.html" class="external-link">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span></span>
<span>    area <span class="op">=</span> <span class="va">colony_size_cm2</span>,</span>
<span>    egg_cover <span class="op">=</span> <span class="va">egg_percent_cover_jar</span>,</span>
<span>    egg_depth <span class="op">=</span> <span class="va">egg_layer_tickness_mm</span>,</span>
<span>    egg_diameter <span class="op">=</span> <span class="va">mean_egg_diameter_um</span></span>
<span>  <span class="op">)</span><span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">treatment</span>, <span class="va">species</span>, <span class="va">area</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html" class="external-link">drop_na</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">species</span>, <span class="st">"_"</span>, <span class="va">treatment</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check colony area differences</span></span>
<span></span>
<span><span class="co"># fm_area &lt;- brms::brm(</span></span>
<span><span class="co">#   area ~  species,</span></span>
<span><span class="co">#   data = colony_area_output,</span></span>
<span><span class="co">#   cores = 10,</span></span>
<span><span class="co">#   chains = 4,</span></span>
<span><span class="co">#   iter = 6000</span></span>
<span><span class="co"># )</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># saveRDS(fm_area, "/Users/rof011/reefspawn/code/fm_area.rds")</span></span>
<span></span>
<span><span class="va">fm_area</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"/Users/rof011/reefspawn/code/fm_area.rds"</span><span class="op">)</span></span></code></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://paulbuerkner.com/brms/reference/hypothesis.brmsfit.html" class="external-link">hypothesis</a></span><span class="op">(</span><span class="va">fm_egg_size</span>, <span class="st">"treatmentunimpacted = 0"</span><span class="op">)</span></span></code></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Hypothesis Tests for class b:
                Hypothesis Estimate Est.Error CI.Lower CI.Upper Evid.Ratio
1 (treatmentunimpac... = 0    -2.23     65.03  -131.47   125.31         NA
  Post.Prob Star
1        NA
---
'CI': 90%-CI for one-sided and 95%-CI for two-sided hypotheses.
'*': For one-sided hypotheses, the posterior probability exceeds 95%;
for two-sided hypotheses, the value tested against lies outside the 95%-CI.
Posterior probabilities of point hypotheses assume equal prior probabilities.</code></pre>
</div>
</div>
<p>No strong evidence of a treatment effect in hyacinthus.</p>
<p>Estimate –0.38 [–130.57, +128.79M]</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://paulbuerkner.com/brms/reference/hypothesis.brmsfit.html" class="external-link">hypothesis</a></span><span class="op">(</span><span class="va">fm_area</span>, <span class="st">"speciesspathulatha = 0"</span><span class="op">)</span></span></code></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Hypothesis Tests for class b:
                Hypothesis Estimate Est.Error CI.Lower CI.Upper Evid.Ratio
1 (speciesspathulatha) = 0  -600.54    121.09  -839.39  -359.22         NA
  Post.Prob Star
1        NA    *
---
'CI': 90%-CI for one-sided and 95%-CI for two-sided hypotheses.
'*': For one-sided hypotheses, the posterior probability exceeds 95%;
for two-sided hypotheses, the value tested against lies outside the 95%-CI.
Posterior probabilities of point hypotheses assume equal prior probabilities.</code></pre>
</div>
</div>
<p>No strong evidence of a difference in area between species.</p>
<p>Estimate –600.5 [–839.39, +359.22]</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://paulbuerkner.com/brms/reference/hypothesis.brmsfit.html" class="external-link">hypothesis</a></span><span class="op">(</span><span class="va">fm_egg_size</span>, <span class="st">"speciesspathulatha = 0"</span><span class="op">)</span></span></code></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Hypothesis Tests for class b:
                Hypothesis Estimate Est.Error CI.Lower CI.Upper Evid.Ratio
1 (speciesspathulatha) = 0    -0.16     61.19  -119.61   121.28         NA
  Post.Prob Star
1        NA
---
'CI': 90%-CI for one-sided and 95%-CI for two-sided hypotheses.
'*': For one-sided hypotheses, the posterior probability exceeds 95%;
for two-sided hypotheses, the value tested against lies outside the 95%-CI.
Posterior probabilities of point hypotheses assume equal prior probabilities.</code></pre>
</div>
</div>
</section><section class="level2"><h3 id="oocyte-biomass">Oocyte biomass<a class="anchor" aria-label="anchor" href="#oocyte-biomass"></a>
</h3>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#| class-source: fold-hide</span></span>
<span><span class="co">#| message: false</span></span>
<span><span class="co">#| warning: false</span></span>
<span><span class="co">#| fig-width: 9.5</span></span>
<span><span class="co">#| fig-height: 5</span></span>
<span></span>
<span><span class="va">reproductive_output</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span><span class="st">"/Users/rof011/reefspawn/code/SurvExpData.xlsx"</span>, sheet <span class="op">=</span> <span class="st">"ReprodOutput"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/clean_names.html" class="external-link">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>area <span class="op">=</span> <span class="va">colony_size_cm2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    egg_cover <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">egg_percent_cover_jar</span><span class="op">)</span>,</span>
<span>    egg_depth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">egg_layer_tickness_mm</span><span class="op">)</span>,</span>
<span>    egg_diameter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">mean_egg_diameter_um</span><span class="op">)</span>,</span>
<span>    treatment <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">treatment</span>, <span class="st">"SURV"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"impacted"</span>,</span>
<span>      <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">treatment</span>, <span class="st">"NORM"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"unimpacted"</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">treatment</span>, <span class="va">species</span>, <span class="va">area</span>, <span class="va">egg_diameter</span>, <span class="va">egg_cover</span>, <span class="va">egg_depth</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>output <span class="op">=</span> <span class="fu"><a href="../reference/calculate_egg_densities.html">calculate_egg_densities</a></span><span class="op">(</span><span class="va">egg_diameter</span>,<span class="va">egg_cover</span>, <span class="va">egg_depth</span>, method <span class="op">=</span> <span class="st">"3d_packing"</span><span class="op">)</span>,</span>
<span>                output2 <span class="op">=</span> <span class="fu"><a href="../reference/calculate_egg_densities.html">calculate_egg_densities</a></span><span class="op">(</span><span class="va">egg_diameter</span>,<span class="va">egg_cover</span>, <span class="va">egg_depth</span>, method <span class="op">=</span> <span class="st">"layered"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">species</span>, <span class="st">"_"</span>, <span class="va">treatment</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html" class="external-link">drop_na</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>output <span class="op">=</span> <span class="va">output</span> <span class="op">/</span> <span class="va">area</span>,</span>
<span>         output2 <span class="op">=</span> <span class="va">output2</span> <span class="op">/</span> <span class="va">area</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># # Fit model with species interaction</span></span>
<span><span class="co"># fm_reproductive_output &lt;- brm(</span></span>
<span><span class="co">#   output ~ treatment * species,</span></span>
<span><span class="co">#   data = reproductive_output,</span></span>
<span><span class="co">#   cores = 10,</span></span>
<span><span class="co">#   chains = 4,</span></span>
<span><span class="co">#   iter = 6000</span></span>
<span><span class="co"># )</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># saveRDS(fm_reproductive_output, "/Users/rof011/reefspawn/code/fm_reproductive_output.rds")</span></span>
<span></span>
<span><span class="va">fm_reproductive_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"/Users/rof011/reefspawn/code/fm_reproductive_output.rds"</span><span class="op">)</span></span>
<span>        </span>
<span><span class="co"># Extract fitted values</span></span>
<span><span class="va">fitted_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://geobosh.github.io/fGarchDoc/reference/methods-fitted.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">fm_reproductive_output</span>, scale <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">reproductive_output</span> <span class="op">&lt;-</span> <span class="va">reproductive_output</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    predicted <span class="op">=</span> <span class="va">fitted_vals</span><span class="op">[</span>, <span class="st">"Estimate"</span><span class="op">]</span>,</span>
<span>    lower <span class="op">=</span> <span class="va">fitted_vals</span><span class="op">[</span>, <span class="st">"Q2.5"</span><span class="op">]</span>,</span>
<span>    upper <span class="op">=</span> <span class="va">fitted_vals</span><span class="op">[</span>, <span class="st">"Q97.5"</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Summarise predictions per treatment × species for plotting box layer</span></span>
<span></span>
<span><span class="va">reproductive_summary</span> <span class="op">&lt;-</span> <span class="va">reproductive_output</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">treatment</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    predicted <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">predicted</span><span class="op">)</span>,</span>
<span>    lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">lower</span><span class="op">)</span>,</span>
<span>    upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">upper</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">species</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">reproductive_output</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">treatment</span>, y <span class="op">=</span> <span class="va">output</span>, fill <span class="op">=</span> <span class="va">treatment</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"grey50"</span>, scale <span class="op">=</span> <span class="st">"width"</span>, alpha <span class="op">=</span> <span class="fl">0.6</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">reproductive_output</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">treatment</span>, y <span class="op">=</span> <span class="va">output</span>, fill <span class="op">=</span> <span class="va">treatment</span><span class="op">)</span>,</span>
<span>    width <span class="op">=</span> <span class="fl">0.05</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">reproductive_summary</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">treatment</span>, fill <span class="op">=</span> <span class="va">treatment</span>,</span>
<span>        lower <span class="op">=</span> <span class="va">lower</span>, upper <span class="op">=</span> <span class="va">upper</span>,</span>
<span>        middle <span class="op">=</span> <span class="va">predicted</span>, ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span><span class="op">)</span>,</span>
<span>    stat <span class="op">=</span> <span class="st">"identity"</span>, width <span class="op">=</span> <span class="fl">0.2</span>, alpha <span class="op">=</span> <span class="fl">0.7</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Reproductive output (n per cm2)"</span>, title <span class="op">=</span> <span class="st">"Reproductive output by Treatment"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"navajowhite2"</span>, <span class="st">"paleturquoise"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</details><div class="cell-output-display">
<div>
<figure><p><img src="experimental_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://paulbuerkner.com/brms/reference/hypothesis.brmsfit.html" class="external-link">hypothesis</a></span><span class="op">(</span><span class="va">fm_reproductive_output</span>, <span class="st">"treatmentunimpacted = 0"</span><span class="op">)</span></span></code></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Hypothesis Tests for class b:
                Hypothesis Estimate Est.Error  CI.Lower CI.Upper Evid.Ratio
1 (treatmentunimpac... = 0 -5138974  19355732 -42924849 32449033         NA
  Post.Prob Star
1        NA
---
'CI': 90%-CI for one-sided and 95%-CI for two-sided hypotheses.
'*': For one-sided hypotheses, the posterior probability exceeds 95%;
for two-sided hypotheses, the value tested against lies outside the 95%-CI.
Posterior probabilities of point hypotheses assume equal prior probabilities.</code></pre>
</div>
</div>
<p>No strong evidence of a treatment effect in hyacinthus.</p>
<p>Estimate –5.5M [–43.8, +33.3]</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://paulbuerkner.com/brms/reference/hypothesis.brmsfit.html" class="external-link">hypothesis</a></span><span class="op">(</span><span class="va">fm_reproductive_output</span>, <span class="st">"treatmentunimpacted + treatmentunimpacted:speciesspathulatha = 0"</span><span class="op">)</span></span></code></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Hypothesis Tests for class b:
                Hypothesis  Estimate Est.Error  CI.Lower  CI.Upper Evid.Ratio
1 (treatmentunimpac... = 0 -58137442  19952480 -97621677 -18695671         NA
  Post.Prob Star
1        NA    *
---
'CI': 90%-CI for one-sided and 95%-CI for two-sided hypotheses.
'*': For one-sided hypotheses, the posterior probability exceeds 95%;
for two-sided hypotheses, the value tested against lies outside the 95%-CI.
Posterior probabilities of point hypotheses assume equal prior probabilities.</code></pre>
</div>
</div>
<p>Strong evidence that reproductive output is lower in unimpacted spathulata</p>
<p>Estimate –57.9M [–96.7M, –18.9M]</p>
</section><section class="level2"><h3 id="larval-development">Larval development<a class="anchor" aria-label="anchor" href="#larval-development"></a>
</h3>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#| class-source: fold-hide</span></span>
<span><span class="co">#| message: false</span></span>
<span><span class="co">#| warning: false</span></span>
<span><span class="co">#| fig-width: 9.5</span></span>
<span><span class="co">#| fig-height: 5</span></span>
<span></span>
<span></span>
<span><span class="va">string_treatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"S1"</span>,<span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"N2"</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"S2"</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"N1"</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">onboard_cultures</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span><span class="st">"/Users/rof011/reefspawn/code/SurvExpData.xlsx"</span>, sheet <span class="op">=</span> <span class="st">"OnboardCulture"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/clean_names.html" class="external-link">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># clean up time</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="va">samping_date</span>, format <span class="op">=</span> <span class="st">"%d/%m/%Y"</span>, tz <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">time</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span>, units <span class="op">=</span> <span class="st">"days"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># clean up ID</span></span>
<span>  <span class="co">#dplyr::filter(!is.na(treatment_id)) |&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>treatment <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove</a></span><span class="op">(</span><span class="va">treatment_id</span>, <span class="st">"^Tank_"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>sample_prefix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">sample_id</span><span class="op">)</span>, <span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">sample_id</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">treatment_id</span><span class="op">)</span>, <span class="va">sample_prefix</span>, <span class="va">treatment_id</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  <span class="co"># replace missing treatment_id with sample_prefix, check seperately</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">treatment</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"N1"</span>, <span class="st">"N2"</span>, <span class="st">"S1"</span>, <span class="st">"S2"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>rep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span><span class="op">)</span>, <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">treatment</span>, <span class="va">time</span>, <span class="va">deformed</span>, <span class="va">normal</span>, <span class="va">total_larvae</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">treatment</span>, <span class="va">time</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>deformed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">deformed</span><span class="op">)</span>, normal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">normal</span><span class="op">)</span>, total_larvae <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">total_larvae</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">treatment</span>, <span class="st">"1$"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"hyacinthus"</span>,</span>
<span>    <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">treatment</span>, <span class="st">"2$"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"spathulata"</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">species</span>, <span class="st">"_"</span>, <span class="va">treatment</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html" class="external-link">separate</a></span><span class="op">(</span><span class="va">var</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"species"</span>, <span class="st">"treatment"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>condition <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">treatment</span>, <span class="st">"^N"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"unimpacted"</span>,</span>
<span>    <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">treatment</span>, <span class="st">"^S"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"impacted"</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>total_larvae <span class="op">=</span> <span class="op">(</span><span class="va">total_larvae</span><span class="op">/</span><span class="fl">16</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1000</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>treatment <span class="op">=</span> <span class="va">condition</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># quadratic_counts &lt;- brm(</span></span>
<span><span class="co">#   total_larvae ~ time + I(time^2) * treatment * species,</span></span>
<span><span class="co">#   data = onboard_cultures,</span></span>
<span><span class="co">#   family = gaussian(),</span></span>
<span><span class="co">#   chains = 4, cores = 4</span></span>
<span><span class="co"># )</span></span>
<span></span>
<span><span class="co"># saveRDS(quadratic_counts, "/Users/rof011/reefspawn/code/quadratic_counts.rds")</span></span>
<span></span>
<span><span class="va">quadratic_counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"/Users/rof011/reefspawn/code/quadratic_counts.rds"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Expand prediction grid with full interaction structure</span></span>
<span><span class="va">newdata</span> <span class="op">&lt;-</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand_grid.html" class="external-link">expand_grid</a></span><span class="op">(</span></span>
<span>  time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">onboard_cultures</span><span class="op">$</span><span class="va">time</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">onboard_cultures</span><span class="op">$</span><span class="va">time</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>,</span>
<span>  treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">onboard_cultures</span><span class="op">$</span><span class="va">treatment</span><span class="op">)</span>,</span>
<span>  species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">onboard_cultures</span><span class="op">$</span><span class="va">species</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get predicted values with uncertainty</span></span>
<span><span class="va">quad_fitted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://geobosh.github.io/fGarchDoc/reference/methods-fitted.html" class="external-link">fitted</a></span><span class="op">(</span></span>
<span>  <span class="va">quadratic_counts</span>,</span>
<span>  newdata <span class="op">=</span> <span class="va">newdata</span>,</span>
<span>  scale <span class="op">=</span> <span class="st">"response"</span>,</span>
<span>  allow_new_levels <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine predictions</span></span>
<span><span class="va">newdata_quad</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="va">newdata</span>, <span class="va">quad_fitted</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add condition back (if needed for fill/color)</span></span>
<span><span class="va">newdata_quad</span> <span class="op">&lt;-</span> <span class="va">newdata_quad</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">onboard_cultures</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">treatment</span>, <span class="va">species</span>, <span class="va">condition</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"treatment"</span>, <span class="st">"species"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">species</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">newdata_quad</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, ymin <span class="op">=</span> <span class="va">Q2.5</span>, ymax <span class="op">=</span> <span class="va">Q97.5</span>, fill <span class="op">=</span> <span class="va">condition</span><span class="op">)</span>,</span>
<span>              alpha <span class="op">=</span> <span class="fl">0.5</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">newdata_quad</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">Estimate</span>, color <span class="op">=</span> <span class="va">condition</span><span class="op">)</span>,</span>
<span>            linewidth <span class="op">=</span> <span class="fl">1.2</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">onboard_cultures</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">total_larvae</span>, color <span class="op">=</span> <span class="va">condition</span><span class="op">)</span>,</span>
<span>            linetype <span class="op">=</span> <span class="st">"dashed"</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">onboard_cultures</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">total_larvae</span>, fill <span class="op">=</span> <span class="va">condition</span><span class="op">)</span>,</span>
<span>             shape <span class="op">=</span> <span class="fl">21</span>, color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.9</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Quadratic fit of larval counts over time"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"n larvae / litre"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Time (days)"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"navajowhite"</span>, <span class="st">"paleturquoise"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"navajowhite3"</span>, <span class="st">"paleturquoise3"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2500</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</details><div class="cell-output-display">
<div>
<figure><p><img src="experimental_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://paulbuerkner.com/brms/reference/hypothesis.brmsfit.html" class="external-link">hypothesis</a></span><span class="op">(</span><span class="va">quadratic_counts</span>, <span class="st">"treatmentunimpacted + ItimeE2:treatmentunimpacted = 0"</span><span class="op">)</span></span></code></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Hypothesis Tests for class b:
                Hypothesis Estimate Est.Error CI.Lower CI.Upper Evid.Ratio
1 (treatmentunimpac... = 0   215.11    457.61  -717.78   1165.8         NA
  Post.Prob Star
1        NA
---
'CI': 90%-CI for one-sided and 95%-CI for two-sided hypotheses.
'*': For one-sided hypotheses, the posterior probability exceeds 95%;
for two-sided hypotheses, the value tested against lies outside the 95%-CI.
Posterior probabilities of point hypotheses assume equal prior probabilities.</code></pre>
</div>
</div>
<p>No strong evidence of a treatment effect in spathulata.</p>
<p>Estimate 456.2 [–483.5, +1409.8]</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://paulbuerkner.com/brms/reference/hypothesis.brmsfit.html" class="external-link">hypothesis</a></span><span class="op">(</span><span class="va">quadratic_counts</span>,</span>
<span>  <span class="st">"treatmentunimpacted +</span></span>
<span><span class="st">   ItimeE2:treatmentunimpacted +</span></span>
<span><span class="st">   treatmentunimpacted:speciesspathulata +</span></span>
<span><span class="st">   ItimeE2:treatmentunimpacted:speciesspathulata = 0"</span><span class="op">)</span></span></code></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Hypothesis Tests for class b:
                Hypothesis Estimate Est.Error CI.Lower CI.Upper Evid.Ratio
1 (treatmentunimpac... = 0  -483.54    456.21 -1409.84   430.19         NA
  Post.Prob Star
1        NA
---
'CI': 90%-CI for one-sided and 95%-CI for two-sided hypotheses.
'*': For one-sided hypotheses, the posterior probability exceeds 95%;
for two-sided hypotheses, the value tested against lies outside the 95%-CI.
Posterior probabilities of point hypotheses assume equal prior probabilities.</code></pre>
</div>
</div>
<p>No strong evidence of a treatment effect in hyacinthus.</p>
<p>Estimate –456.21 [–1409.84, 430.191]</p>
</section><section class="level2"><h3 id="larval-settlement-5-days">Larval settlement (5 days)<a class="anchor" aria-label="anchor" href="#larval-settlement-5-days"></a>
</h3>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#| class-source: fold-hide</span></span>
<span><span class="co">#| message: false</span></span>
<span><span class="co">#| warning: false</span></span>
<span><span class="co">#| fig-width: 9.5</span></span>
<span><span class="co">#| fig-height: 5</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">tiles</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span><span class="st">"/Users/rof011/reefspawn/code/SurvExpData.xlsx"</span>, sheet <span class="op">=</span> <span class="st">"SetTilesSurvREEF_cleaned"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/clean_names.html" class="external-link">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>days <span class="op">=</span> <span class="va">date_scored</span> <span class="op">-</span> <span class="va">date_tile_deployment</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">plot_id</span>, <span class="va">days</span>, <span class="va">tile_face</span>, <span class="va">treatment</span>, <span class="va">tile_number</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>total_count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">settler_count</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>days <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">days</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>days <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">days</span> <span class="op">&lt;</span><span class="fl">100</span>, <span class="st">"5 days"</span>, <span class="st">"110 days"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>days <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">days</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">treatment</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Normal"</span>, <span class="st">"Survivor"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    treatment <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">treatment</span>, <span class="st">"Survivor"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"impacted"</span>,</span>
<span>      <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">treatment</span>, <span class="st">"Normal"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"unimpacted"</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">tiles_grouped</span> <span class="op">&lt;-</span> <span class="va">tiles</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">days</span>, <span class="va">treatment</span>, <span class="va">plot_id</span>, <span class="va">tile_number</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>total_count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">total_count</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tiles_grouped_mean</span> <span class="op">&lt;-</span> <span class="va">tiles_grouped</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">days</span>, <span class="va">treatment</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>total_count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">total_count</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">### first timepoint</span></span>
<span></span>
<span><span class="va">tiles_counts_a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brm</a></span><span class="op">(</span></span>
<span>  <span class="va">total_count</span> <span class="op">~</span> <span class="va">treatment</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">plot_id</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">tiles_grouped</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">days</span> <span class="op">==</span> <span class="st">"5 days"</span><span class="op">)</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">4</span>, cores <span class="op">=</span> <span class="fl">4</span></span>
<span><span class="op">)</span></span></code></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
using C compiler: ‘Apple clang version 17.0.0 (clang-1700.0.13.3)’
using SDK: ‘MacOSX15.4.sdk’
clang -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG   -I"/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/Rcpp/include/"  -I"/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/RcppEigen/include/"  -I"/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/RcppEigen/include/unsupported"  -I"/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/BH/include" -I"/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/StanHeaders/include/src/"  -I"/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/StanHeaders/include/"  -I"/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/RcppParallel/include/"  -I"/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DUSE_STANC3 -DSTRICT_R_HEADERS  -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION  -D_HAS_AUTO_PTR_ETC=0  -include '/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/opt/R/arm64/include    -fPIC  -O3 -mtune=native -march=native -c foo.c -o foo.o
In file included from &lt;built-in&gt;:1:
In file included from /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp:22:
In file included from /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/RcppEigen/include/Eigen/Dense:1:
In file included from /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/RcppEigen/include/Eigen/Core:19:
/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:679:10: fatal error: 'cmath' file not found
  679 | #include &lt;cmath&gt;
      |          ^~~~~~~
1 error generated.
make: *** [foo.o] Error 1</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># saveRDS(tiles_counts_a, "/Users/rof011/reefspawn/code/tiles_counts_a.rds")</span></span>
<span></span>
<span><span class="va">tiles_counts_a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"/Users/rof011/reefspawn/code/tiles_counts_a.rds"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create prediction grid</span></span>
<span><span class="va">tiles_counts_a_newdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span></span>
<span>  treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">tiles_grouped</span><span class="op">$</span><span class="va">treatment</span><span class="op">)</span>,</span>
<span>  plot_id <span class="op">=</span> <span class="cn">NA</span>  <span class="co"># marginalize over random effect</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get fitted values on response scale with uncertainty</span></span>
<span><span class="va">tiles_counts_a_fitted_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://geobosh.github.io/fGarchDoc/reference/methods-fitted.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">tiles_counts_a</span>, newdata <span class="op">=</span> <span class="va">tiles_counts_a_newdata</span>, scale <span class="op">=</span> <span class="st">"response"</span>, allow_new_levels <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">tiles_counts_a_newdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="va">tiles_counts_a_newdata</span>, <span class="va">tiles_counts_a_fitted_vals</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#</span></span>
<span><span class="co"># ggplot() +</span></span>
<span><span class="co">#   theme_bw() +</span></span>
<span><span class="co">#   geom_point(data = tiles_grouped |&gt; filter(days == "5 days"), aes(x = treatment, y = total_count, fill = treatment),</span></span>
<span><span class="co">#              shape = 21, color = "black", alpha = 0.5, size = 2, position = position_jitter(width = 0.1)) +</span></span>
<span><span class="co">#   geom_pointrange(data = tiles_counts_a_newdata,</span></span>
<span><span class="co">#                   aes(x = treatment, y = Estimate, ymin = Q2.5, ymax = Q97.5, fill = treatment),</span></span>
<span><span class="co">#                   shape = 21, color = "black", size = 1.2) +</span></span>
<span><span class="co">#   labs(title = "Predicted settler counts by treatment (ZIP model)",</span></span>
<span><span class="co">#        y = "Predicted count (mean ± 95% CI)", x = "Treatment") +</span></span>
<span><span class="co">#   scale_fill_manual(values = c("paleturquoise", "navajowhite"))</span></span>
<span></span>
<span><span class="va">tileplot_a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">days</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">tiles_grouped</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">days</span> <span class="op">==</span> <span class="st">"5 days"</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">treatment</span>, <span class="va">total_count</span>, fill<span class="op">=</span><span class="va">treatment</span><span class="op">)</span>, linewidth<span class="op">=</span><span class="fl">0.25</span>, alpha<span class="op">=</span><span class="fl">0.2</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">tiles_grouped</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">days</span> <span class="op">==</span> <span class="st">"5 days"</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">treatment</span>, <span class="va">total_count</span><span class="op">)</span>, width<span class="op">=</span><span class="fl">0.1</span>, size<span class="op">=</span><span class="fl">0.4</span>, alpha<span class="op">=</span><span class="fl">0.2</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_pointrange</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">tiles_counts_a_newdata</span>,</span>
<span>                  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">treatment</span>, y <span class="op">=</span> <span class="va">Estimate</span>, ymin <span class="op">=</span> <span class="va">Q2.5</span>, ymax <span class="op">=</span> <span class="va">Q97.5</span>, fill <span class="op">=</span> <span class="va">treatment</span><span class="op">)</span>,</span>
<span>                  shape <span class="op">=</span> <span class="fl">21</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">0.6</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"paleturquoise"</span>, <span class="st">"navajowhite"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Larvae per tile"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tileplot_a</span></span></code></pre></div>
</details><div class="cell-output-display">
<div>
<figure><p><img src="experimental_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://paulbuerkner.com/brms/reference/hypothesis.brmsfit.html" class="external-link">hypothesis</a></span><span class="op">(</span><span class="va">tiles_counts_a</span>, <span class="st">"treatmentunimpacted = 0"</span><span class="op">)</span></span></code></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Hypothesis Tests for class b:
                Hypothesis Estimate Est.Error CI.Lower CI.Upper Evid.Ratio
1 (treatmentunimpac... = 0   -87.49     47.36  -176.56     4.67         NA
  Post.Prob Star
1        NA
---
'CI': 90%-CI for one-sided and 95%-CI for two-sided hypotheses.
'*': For one-sided hypotheses, the posterior probability exceeds 95%;
for two-sided hypotheses, the value tested against lies outside the 95%-CI.
Posterior probabilities of point hypotheses assume equal prior probabilities.</code></pre>
</div>
</div>
<p>There is some evidence that unimpacted reefs had lower settler counts than impacted reefs. The effect size is large (–87), but uncertain — CI includes small positive values</p>
<p>Estimate -87.5 [–176.6, +4.7]</p>
</section><section class="level2"><h3 id="larval-recruitment-3-months">Larval recruitment (3 months)<a class="anchor" aria-label="anchor" href="#larval-recruitment-3-months"></a>
</h3>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#| class-source: fold-hide</span></span>
<span><span class="co">#| message: false</span></span>
<span><span class="co">#| warning: false</span></span>
<span><span class="co">#| fig-width: 9.5</span></span>
<span><span class="co">#| fig-height: 5</span></span>
<span></span>
<span></span>
<span><span class="co"># tiles_counts_b &lt;- brm(</span></span>
<span><span class="co">#   total_count ~ treatment + (1|plot_id),</span></span>
<span><span class="co">#   data = tiles_grouped |&gt; filter(days == "110 days"),</span></span>
<span><span class="co">#   family = zero_inflated_poisson(),</span></span>
<span><span class="co">#   chains = 4, cores = 4, adapt_delta = 0.95:</span></span>
<span><span class="co"># )</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># saveRDS(tiles_counts_b, "/Users/rof011/reefspawn/code/tiles_counts_b.rds")</span></span>
<span></span>
<span><span class="va">tiles_counts_b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"/Users/rof011/reefspawn/code/tiles_counts_b.rds"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Create prediction grid</span></span>
<span><span class="va">tiles_counts_b_newdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span></span>
<span>  treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">tiles_grouped</span><span class="op">$</span><span class="va">treatment</span><span class="op">)</span>,</span>
<span>  plot_id <span class="op">=</span> <span class="cn">NA</span>  <span class="co"># marginalize over random effect</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get fitted values on response scale with uncertainty</span></span>
<span><span class="va">tiles_counts_b_fitted_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://geobosh.github.io/fGarchDoc/reference/methods-fitted.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">tiles_counts_b</span>, newdata <span class="op">=</span> <span class="va">tiles_counts_b_newdata</span>, scale <span class="op">=</span> <span class="st">"response"</span>, allow_new_levels <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">tiles_counts_b_newdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="va">tiles_counts_b_newdata</span>, <span class="va">tiles_counts_b_fitted_vals</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#</span></span>
<span><span class="co"># tileplot_b &lt;- ggplot() +</span></span>
<span><span class="co">#   theme_bw() +</span></span>
<span><span class="co">#   geom_point(data = tiles_grouped |&gt; filter(days == "5 days"), aes(x = treatment, y = total_count, fill = treatment),</span></span>
<span><span class="co">#              shape = 21, color = "black", alpha = 0.5, size = 2, position = position_jitter(width = 0.1)) +</span></span>
<span><span class="co">#   geom_pointrange(data = tiles_counts_b_newdata,</span></span>
<span><span class="co">#                   aes(x = treatment, y = Estimate, ymin = Q2.5, ymax = Q97.5, fill = treatment),</span></span>
<span><span class="co">#                   shape = 21, color = "black", size = 1.2) +</span></span>
<span><span class="co">#   labs(title = "Predicted settler counts by treatment (ZIP model)",</span></span>
<span><span class="co">#        y = "Predicted count (mean ± 95% CI)", x = "Treatment") +</span></span>
<span><span class="co">#   scale_fill_manual(values = c("paleturquoise", "navajowhite"))</span></span>
<span></span>
<span><span class="va">tileplot_b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">days</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">tiles_grouped</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">days</span> <span class="op">==</span> <span class="st">"110 days"</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">treatment</span>, <span class="va">total_count</span>, fill<span class="op">=</span><span class="va">treatment</span><span class="op">)</span>, linewidth<span class="op">=</span><span class="fl">0.25</span>, alpha<span class="op">=</span><span class="fl">0.2</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">tiles_grouped</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">days</span> <span class="op">==</span> <span class="st">"110 days"</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">treatment</span>, <span class="va">total_count</span><span class="op">)</span>, width<span class="op">=</span><span class="fl">0.1</span>, size<span class="op">=</span><span class="fl">0.4</span>, alpha<span class="op">=</span><span class="fl">0.2</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_pointrange</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">tiles_counts_b_newdata</span>,</span>
<span>                  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">treatment</span>, y <span class="op">=</span> <span class="va">Estimate</span>, ymin <span class="op">=</span> <span class="va">Q2.5</span>, ymax <span class="op">=</span> <span class="va">Q97.5</span>, fill <span class="op">=</span> <span class="va">treatment</span><span class="op">)</span>,</span>
<span>                  shape <span class="op">=</span> <span class="fl">21</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, stroke <span class="op">=</span> <span class="fl">0.5</span>, color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">0.6</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"paleturquoise"</span>, <span class="st">"navajowhite"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Larvae per tile"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tileplot_b</span></span></code></pre></div>
</details><div class="cell-output-display">
<div>
<figure><p><img src="experimental_files/figure-html/unnamed-chunk-13-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://paulbuerkner.com/brms/reference/hypothesis.brmsfit.html" class="external-link">hypothesis</a></span><span class="op">(</span><span class="va">tiles_counts_b</span>, <span class="st">"treatmentunimpacted = 0"</span><span class="op">)</span></span></code></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Hypothesis Tests for class b:
                Hypothesis Estimate Est.Error CI.Lower CI.Upper Evid.Ratio
1 (treatmentunimpac... = 0    -0.52      0.47    -1.42     0.43         NA
  Post.Prob Star
1        NA
---
'CI': 90%-CI for one-sided and 95%-CI for two-sided hypotheses.
'*': For one-sided hypotheses, the posterior probability exceeds 95%;
for two-sided hypotheses, the value tested against lies outside the 95%-CI.
Posterior probabilities of point hypotheses assume equal prior probabilities.</code></pre>
</div>
</div>
<p>No strong evidence of a treatment effect</p>
<p>Estimate 0.52 [–1.42, +0.43]</p>
</section></section><section class="section level2"><h2 id="posterior-predictions">Posterior predictions<a class="anchor" aria-label="anchor" href="#posterior-predictions"></a>
</h2>
<section class="level2"><h3 id="i-effect-sizes-impacted-vs-unimpacted">i) effect sizes (impacted vs unimpacted)<a class="anchor" aria-label="anchor" href="#i-effect-sizes-impacted-vs-unimpacted"></a>
</h3>
<p>proportional effect sizes, calculated as:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Effect size</mtext><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mtext mathvariant="normal">impacted</mtext><mtext mathvariant="normal">unimpacted</mtext></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">
\text{Effect size} = \left( \frac{\text{impacted}}{\text{unimpacted}} \right) - 1
</annotation></semantics></math></p>
<p>where:</p>
<pre><code>•   1 = no effect (impacted = unimpacted)
•   &lt;1 = negative effect (impacted &lt; unimpacted)
•   &gt;1 = positive effect (impacted &gt; unimpacted)</code></pre>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##############################</span></span>
<span><span class="co">##### fm_egg_size</span></span>
<span><span class="co">##############################</span></span>
<span></span>
<span><span class="va">posterior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">fm_egg_size</span><span class="op">)</span></span>
<span><span class="va">mu_hyacinthus_impacted</span> <span class="op">&lt;-</span> <span class="va">posterior</span><span class="op">$</span><span class="va">b_Intercept</span></span>
<span><span class="va">mu_hyacinthus_unimpacted</span> <span class="op">&lt;-</span> <span class="va">posterior</span><span class="op">$</span><span class="va">b_Intercept</span> <span class="op">+</span> <span class="va">posterior</span><span class="op">$</span><span class="va">b_treatmentunimpacted</span></span>
<span><span class="va">mu_spathulata_impacted</span> <span class="op">&lt;-</span> <span class="va">posterior</span><span class="op">$</span><span class="va">b_Intercept</span> <span class="op">+</span> <span class="va">posterior</span><span class="op">$</span><span class="va">`b_speciesspathulatha`</span></span>
<span><span class="va">mu_spathulata_unimpacted</span> <span class="op">&lt;-</span> <span class="va">mu_spathulata_impacted</span> <span class="op">+</span></span>
<span>  <span class="va">posterior</span><span class="op">$</span><span class="va">`b_treatmentunimpacted`</span> <span class="op">+</span></span>
<span>  <span class="va">posterior</span><span class="op">$</span><span class="va">`b_treatmentunimpacted:speciesspathulatha`</span></span>
<span></span>
<span><span class="va">rel_pct_hyacinthus</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">mu_hyacinthus_impacted</span> <span class="op">/</span> <span class="va">mu_hyacinthus_unimpacted</span><span class="op">)</span></span>
<span><span class="va">rel_pct_spathulata</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">mu_spathulata_impacted</span> <span class="op">/</span> <span class="va">mu_spathulata_unimpacted</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fm_egg_size_posterior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hyacinthus"</span>, <span class="st">"spathulata"</span><span class="op">)</span>,</span>
<span>  effect_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rel_pct_hyacinthus</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rel_pct_spathulata</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>  effect_lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">rel_pct_hyacinthus</span>, <span class="fl">0.025</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">rel_pct_spathulata</span>, <span class="fl">0.025</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>  effect_upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">rel_pct_hyacinthus</span>, <span class="fl">0.975</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">rel_pct_spathulata</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>stage <span class="op">=</span> <span class="st">"1. oocyte size"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">##############################</span></span>
<span><span class="co">##### fm_reproductive_output</span></span>
<span><span class="co">##############################</span></span>
<span></span>
<span><span class="va">posterior_repro</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">fm_reproductive_output</span><span class="op">)</span></span>
<span><span class="va">mu_hyacinthus_impacted</span> <span class="op">&lt;-</span> <span class="va">posterior_repro</span><span class="op">$</span><span class="va">b_Intercept</span></span>
<span><span class="va">mu_hyacinthus_unimpacted</span> <span class="op">&lt;-</span> <span class="va">posterior_repro</span><span class="op">$</span><span class="va">b_Intercept</span> <span class="op">+</span> <span class="va">posterior_repro</span><span class="op">$</span><span class="va">b_treatmentunimpacted</span></span>
<span><span class="va">mu_spathulata_impacted</span> <span class="op">&lt;-</span> <span class="va">posterior_repro</span><span class="op">$</span><span class="va">b_Intercept</span> <span class="op">+</span> <span class="va">posterior_repro</span><span class="op">$</span><span class="va">`b_speciesspathulatha`</span></span>
<span><span class="va">mu_spathulata_unimpacted</span> <span class="op">&lt;-</span> <span class="va">mu_spathulata_impacted</span> <span class="op">+</span></span>
<span>  <span class="va">posterior_repro</span><span class="op">$</span><span class="va">`b_treatmentunimpacted`</span> <span class="op">+</span></span>
<span>  <span class="va">posterior_repro</span><span class="op">$</span><span class="va">`b_treatmentunimpacted:speciesspathulatha`</span></span>
<span></span>
<span><span class="va">rel_pct_hyacinthus</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">mu_hyacinthus_impacted</span> <span class="op">/</span> <span class="va">mu_hyacinthus_unimpacted</span><span class="op">)</span></span>
<span><span class="va">rel_pct_spathulata</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">mu_spathulata_impacted</span> <span class="op">/</span> <span class="va">mu_spathulata_unimpacted</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fm_repro_posterior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hyacinthus"</span>, <span class="st">"spathulata"</span><span class="op">)</span>,</span>
<span>  effect_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rel_pct_hyacinthus</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rel_pct_spathulata</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>  effect_lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">rel_pct_hyacinthus</span>, <span class="fl">0.025</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">rel_pct_spathulata</span>, <span class="fl">0.025</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>  effect_upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">rel_pct_hyacinthus</span>, <span class="fl">0.975</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">rel_pct_spathulata</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>stage <span class="op">=</span> <span class="st">"2. reproductive biomass"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">##############################</span></span>
<span><span class="co">##### larval development</span></span>
<span><span class="co">##############################</span></span>
<span></span>
<span><span class="va">posterior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">quadratic_counts</span><span class="op">)</span></span>
<span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fl">1.5</span></span>
<span><span class="va">time2</span> <span class="op">&lt;-</span> <span class="va">time</span><span class="op">^</span><span class="fl">2</span></span>
<span></span>
<span><span class="va">mu_h_impacted</span> <span class="op">&lt;-</span> <span class="va">posterior</span><span class="op">$</span><span class="va">b_Intercept</span> <span class="op">+</span> <span class="va">posterior</span><span class="op">$</span><span class="va">b_time</span> <span class="op">*</span> <span class="va">time</span> <span class="op">+</span> <span class="va">posterior</span><span class="op">$</span><span class="va">`b_ItimeE2`</span> <span class="op">*</span> <span class="va">time2</span></span>
<span><span class="va">mu_h_unimpacted</span> <span class="op">&lt;-</span> <span class="va">mu_h_impacted</span> <span class="op">+</span> <span class="va">posterior</span><span class="op">$</span><span class="va">`b_treatmentunimpacted`</span> <span class="op">+</span> <span class="va">posterior</span><span class="op">$</span><span class="va">`b_ItimeE2:treatmentunimpacted`</span> <span class="op">*</span> <span class="va">time2</span></span>
<span><span class="va">mu_s_impacted</span> <span class="op">&lt;-</span> <span class="va">mu_h_impacted</span> <span class="op">+</span> <span class="va">posterior</span><span class="op">$</span><span class="va">`b_speciesspathulata`</span> <span class="op">+</span> <span class="va">posterior</span><span class="op">$</span><span class="va">`b_ItimeE2:speciesspathulata`</span> <span class="op">*</span> <span class="va">time2</span></span>
<span><span class="va">mu_s_unimpacted</span> <span class="op">&lt;-</span> <span class="va">mu_s_impacted</span> <span class="op">+</span></span>
<span>  <span class="va">posterior</span><span class="op">$</span><span class="va">`b_treatmentunimpacted`</span> <span class="op">+</span></span>
<span>  <span class="va">posterior</span><span class="op">$</span><span class="va">`b_ItimeE2:treatmentunimpacted`</span> <span class="op">*</span> <span class="va">time2</span> <span class="op">+</span></span>
<span>  <span class="va">posterior</span><span class="op">$</span><span class="va">`b_treatmentunimpacted:speciesspathulata`</span> <span class="op">+</span></span>
<span>  <span class="va">posterior</span><span class="op">$</span><span class="va">`b_ItimeE2:treatmentunimpacted:speciesspathulata`</span> <span class="op">*</span> <span class="va">time2</span></span>
<span></span>
<span><span class="va">rel_pct_h</span> <span class="op">&lt;-</span> <span class="va">mu_h_impacted</span> <span class="op">/</span><span class="va">mu_h_unimpacted</span></span>
<span><span class="va">rel_pct_s</span> <span class="op">&lt;-</span> <span class="va">mu_s_impacted</span> <span class="op">/</span> <span class="va">mu_s_unimpacted</span> </span>
<span></span>
<span><span class="va">quadratic_counts_posterior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hyacinthus"</span>, <span class="st">"spathulata"</span><span class="op">)</span>,</span>
<span>  effect_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rel_pct_h</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rel_pct_s</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>  effect_lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">rel_pct_h</span>, <span class="fl">0.025</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">rel_pct_s</span>, <span class="fl">0.025</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>  effect_upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">rel_pct_h</span>, <span class="fl">0.975</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">rel_pct_s</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>stage <span class="op">=</span> <span class="st">"3. larval development"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">##############################</span></span>
<span><span class="co">##### larval settlement</span></span>
<span><span class="co">##############################</span></span>
<span></span>
<span><span class="va">posterior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">tiles_counts_a</span><span class="op">)</span></span>
<span><span class="va">mu_impacted</span> <span class="op">&lt;-</span> <span class="va">posterior</span><span class="op">$</span><span class="va">b_Intercept</span></span>
<span><span class="va">mu_unimpacted</span> <span class="op">&lt;-</span> <span class="va">mu_impacted</span> <span class="op">+</span> <span class="va">posterior</span><span class="op">$</span><span class="va">b_treatmentunimpacted</span></span>
<span><span class="va">rel_pct</span> <span class="op">&lt;-</span> <span class="va">mu_impacted</span><span class="op">/</span> <span class="va">mu_unimpacted</span> </span>
<span></span>
<span><span class="va">tiles_counts_a_posterior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  effect_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rel_pct</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>  effect_lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">rel_pct</span>, <span class="fl">0.025</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>  effect_upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">rel_pct</span>, <span class="fl">0.975</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>  species <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  stage <span class="op">=</span> <span class="st">"4. larval settlement"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">##############################</span></span>
<span><span class="co">##### larval recruitment</span></span>
<span><span class="co">##############################</span></span>
<span></span>
<span><span class="va">posterior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">tiles_counts_b</span><span class="op">)</span></span>
<span><span class="va">log_mu_impacted</span> <span class="op">&lt;-</span> <span class="va">posterior</span><span class="op">$</span><span class="va">b_Intercept</span></span>
<span><span class="va">log_mu_unimpacted</span> <span class="op">&lt;-</span> <span class="va">log_mu_impacted</span> <span class="op">+</span> <span class="va">posterior</span><span class="op">$</span><span class="va">b_treatmentunimpacted</span></span>
<span><span class="va">mu_impacted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">log_mu_impacted</span><span class="op">)</span></span>
<span><span class="va">mu_unimpacted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">log_mu_unimpacted</span><span class="op">)</span></span>
<span><span class="va">rel_pct</span> <span class="op">&lt;-</span>  <span class="va">mu_impacted</span> <span class="op">/</span> <span class="va">mu_unimpacted</span></span>
<span></span>
<span><span class="va">tiles_counts_b_posterior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  effect_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rel_pct</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>  effect_lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">rel_pct</span>, <span class="fl">0.025</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>  effect_upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">rel_pct</span>, <span class="fl">0.975</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>  species <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  stage <span class="op">=</span> <span class="st">"5. larval recruitment"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">##############################</span></span>
<span><span class="co">##### Combine</span></span>
<span><span class="co">##############################</span></span>
<span></span>
<span><span class="va">posterior_prediction_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="va">fm_egg_size_posterior</span>,</span>
<span>  <span class="va">fm_repro_posterior</span>,</span>
<span>  <span class="va">quadratic_counts_posterior</span>,</span>
<span>  <span class="va">tiles_counts_a_posterior</span>,</span>
<span>  <span class="va">tiles_counts_b_posterior</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">effect_size</span>, <span class="va">effect_lower</span>, <span class="va">effect_upper</span><span class="op">)</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">.x</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">effect_size</span>, <span class="va">effect_lower</span>, <span class="va">effect_upper</span><span class="op">)</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span>, <span class="st">"pooled"</span>, <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">stage</span>, <span class="va">species</span>, <span class="va">effect_size</span>, <span class="va">effect_lower</span>, <span class="va">effect_upper</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">stage</span>, <span class="va">species</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">blankdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    stage <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"4. larval settlement"</span>,  <span class="st">"5. larval recruitment"</span><span class="op">)</span>,</span>
<span>    species <span class="op">=</span> <span class="cn">NA</span>, effect_size <span class="op">=</span> <span class="cn">NA</span>, effect_lower <span class="op">=</span> <span class="cn">NA</span>, effect_upper <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span></span>
<span>  <span class="va">posterior_prediction_table</span>,</span>
<span>  rownames <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    pageLength <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    autoWidth <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    dom <span class="op">=</span> <span class="st">'t'</span></span>
<span>  <span class="op">)</span>,</span>
<span>  class <span class="op">=</span> <span class="st">'stripe hover compact'</span>,</span>
<span>  escape <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/formatCurrency.html" class="external-link">formatStyle</a></span><span class="op">(</span></span>
<span>    columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">posterior_prediction_table</span><span class="op">)</span>,</span>
<span>    fontSize <span class="op">=</span> <span class="st">'70%'</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/formatCurrency.html" class="external-link">formatStyle</a></span><span class="op">(</span></span>
<span>    <span class="st">'stage'</span>,</span>
<span>    target <span class="op">=</span> <span class="st">'row'</span>,</span>
<span>    backgroundColor <span class="op">=</span> <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/styleInterval.html" class="external-link">styleEqual</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">posterior_prediction_table</span><span class="op">$</span><span class="va">stage</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/grDevices/gray.colors.html" class="external-link">gray.colors</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">posterior_prediction_table</span><span class="op">$</span><span class="va">stage</span><span class="op">)</span><span class="op">)</span>, start <span class="op">=</span> <span class="fl">0.9</span>, end <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</details><div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-e55cdb31b295d8d4c94b" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-e55cdb31b295d8d4c94b">{"x":{"filter":"none","vertical":false,"data":[["1. oocyte size","1. oocyte size","2. reproductive biomass","2. reproductive biomass","3. larval development","3. larval development","4. larval settlement","5. larval recruitment"],["hyacinthus","spathulata","hyacinthus","spathulata","hyacinthus","spathulata","pooled","pooled"],[0,-0.2,0.4,2.2,-0.1,0.6,1.4,0.9],[-0.2,-0.4,-8.6,0.1,-0.6,-0.3,-0.7,-0.4],[0.4,0.1,9.199999999999999,14.1,0.7,2.3,9.699999999999999,3.1]],"container":"<table class=\"stripe hover compact\">\n  <thead>\n    <tr>\n      <th>stage<\/th>\n      <th>species<\/th>\n      <th>effect_size<\/th>\n      <th>effect_lower<\/th>\n      <th>effect_upper<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"autoWidth":true,"dom":"t","columnDefs":[{"className":"dt-right","targets":[2,3,4]},{"name":"stage","targets":0},{"name":"species","targets":1},{"name":"effect_size","targets":2},{"name":"effect_lower","targets":3},{"name":"effect_upper","targets":4}],"order":[],"orderClasses":false,"rowCallback":"function(row, data, displayNum, displayIndex, dataIndex) {\nvar value=data[0]; $(this.api().cell(row, 0).node()).css({'font-size':'70%'});\nvar value=data[1]; $(this.api().cell(row, 1).node()).css({'font-size':'70%'});\nvar value=data[2]; $(this.api().cell(row, 2).node()).css({'font-size':'70%'});\nvar value=data[3]; $(this.api().cell(row, 3).node()).css({'font-size':'70%'});\nvar value=data[4]; $(this.api().cell(row, 4).node()).css({'font-size':'70%'});\nvar value=data[0]; $(row).css({'background-color':value == \"1. oocyte size\" ? \"#E6E6E6\" : value == \"2. reproductive biomass\" ? \"#DADADA\" : value == \"3. larval development\" ? \"#CECECE\" : value == \"4. larval settlement\" ? \"#C1C1C1\" : value == \"5. larval recruitment\" ? \"#B3B3B3\" : null});\n}"}},"evals":["options.rowCallback"],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">posterior_prediction_table_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">posterior_prediction_table</span>, <span class="va">blankdf</span><span class="op">)</span></span>
<span></span>
<span><span class="va">posterior_predicts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="va">stage</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">posterior_prediction_table_full</span>, </span>
<span>           <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">stage</span>, y <span class="op">=</span> <span class="va">effect_size</span>, group <span class="op">=</span> <span class="va">species</span>, fill <span class="op">=</span> <span class="va">species</span><span class="op">)</span>, </span>
<span>           position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.45</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.4</span>, col<span class="op">=</span><span class="st">"black"</span>, linewidth<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">posterior_prediction_table_full</span>, </span>
<span>                <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">stage</span>, y <span class="op">=</span> <span class="va">effect_size</span>, group <span class="op">=</span> <span class="va">species</span>, ymin <span class="op">=</span> <span class="va">effect_lower</span>, ymax <span class="op">=</span> <span class="va">effect_upper</span><span class="op">)</span>,</span>
<span>                width <span class="op">=</span> <span class="fl">0.1</span>, position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.45</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2.5</span>, <span class="fl">2.5</span><span class="op">)</span>, breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, oob <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/oob.html" class="external-link">oob_keep</a></span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="st">"Effect size (log scale difference)"</span>, fill <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, linewidth<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid.major.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid.minor.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">posterior_predicts</span></span></code></pre></div>
</details><div class="cell-output-display">
<div>
<figure><p><img src="experimental_files/figure-html/unnamed-chunk-16-1.png" width="768"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#ggsave(posterior_predicts,filename="/Users/rof011/reefspawn/code/posterior_predicts.pdf", width=6, height=2)</span></span></code></pre></div>
</details>
</div>
</section><section class="level2"><h3 id="ii-cumulative-effects-across-life-history-stages">ii) cumulative effects across life history stages<a class="anchor" aria-label="anchor" href="#ii-cumulative-effects-across-life-history-stages"></a>
</h3>
<p>The cumulative effect size is the product of all individual stage posteriors:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Cumulative effect</mtext><mo>=</mo><munderover><mo>∏</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><msub><mtext mathvariant="normal">impacted</mtext><mi>i</mi></msub><msub><mtext mathvariant="normal">unimpacted</mtext><mi>i</mi></msub></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">
\text{Cumulative effect} = \displaystyle\prod_{i=1}^n \left( \frac{\text{impacted}_i}{\text{unimpacted}_i} \right) - 1
</annotation></semantics></math></p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode cell-code" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">posterior_prediction_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="va">fm_egg_size_posterior</span>,</span>
<span>  <span class="va">fm_repro_posterior</span>,</span>
<span>  <span class="va">quadratic_counts_posterior</span>,</span>
<span>  <span class="va">tiles_counts_a_posterior</span>,</span>
<span>  <span class="va">tiles_counts_b_posterior</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">effect_size</span>, <span class="va">effect_lower</span>, <span class="va">effect_upper</span><span class="op">)</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">.x</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">effect_size</span>, <span class="va">effect_lower</span>, <span class="va">effect_upper</span><span class="op">)</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span>, <span class="st">"pooled"</span>, <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">stage</span>, <span class="va">species</span>, <span class="va">effect_size</span>, <span class="va">effect_lower</span>, <span class="va">effect_upper</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">stage</span>, <span class="va">species</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">pooled_vals</span> <span class="op">&lt;-</span> <span class="va">posterior_prediction_table</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">species</span> <span class="op">==</span> <span class="st">"pooled"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">blankdf</span> <span class="op">&lt;-</span> <span class="va">pooled_vals</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hyacinthus"</span>, <span class="st">"spathulata"</span><span class="op">)</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">pooled_vals</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">posterior_prediction_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">posterior_prediction_table</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">species</span><span class="op">==</span><span class="st">"pooled"</span><span class="op">)</span>, <span class="va">blankdf</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">stage</span>, <span class="va">species</span><span class="op">)</span></span>
<span></span>
<span><span class="va">posterior_prediction_table_wider</span> <span class="op">&lt;-</span> <span class="va">posterior_prediction_table</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">stage</span>, <span class="va">species</span>, <span class="va">effect_size</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="st">"stage"</span>, values_from <span class="op">=</span> <span class="st">"effect_size"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>oocyte<span class="op">=</span><span class="fl">2</span>, biomass<span class="op">=</span><span class="fl">3</span>, larvae<span class="op">=</span><span class="fl">4</span>, settlement<span class="op">=</span><span class="fl">5</span>, recruitment<span class="op">=</span><span class="fl">6</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>probability <span class="op">=</span> <span class="va">oocyte</span><span class="op">*</span><span class="va">biomass</span><span class="op">*</span><span class="va">larvae</span><span class="op">*</span><span class="va">settlement</span><span class="op">*</span><span class="va">recruitment</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#### posterior </span></span>
<span><span class="co"># ========================</span></span>
<span><span class="co"># 1. Extract posteriors</span></span>
<span><span class="co"># ========================</span></span>
<span></span>
<span><span class="va">posterior_egg</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">fm_egg_size</span><span class="op">)</span></span>
<span><span class="va">posterior_repro</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">fm_reproductive_output</span><span class="op">)</span></span>
<span><span class="va">posterior_dev</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">quadratic_counts</span><span class="op">)</span></span>
<span><span class="va">posterior_settle</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">tiles_counts_a</span><span class="op">)</span></span>
<span><span class="va">posterior_recruit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">tiles_counts_b</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ========================</span></span>
<span><span class="co"># 2. Posterior ratios</span></span>
<span><span class="co"># ========================</span></span>
<span></span>
<span><span class="co">## Egg size</span></span>
<span><span class="va">rel_pct_egg_h</span> <span class="op">&lt;-</span> <span class="va">posterior_egg</span><span class="op">$</span><span class="va">b_Intercept</span> <span class="op">/</span> <span class="op">(</span><span class="va">posterior_egg</span><span class="op">$</span><span class="va">b_Intercept</span> <span class="op">+</span> <span class="va">posterior_egg</span><span class="op">$</span><span class="va">b_treatmentunimpacted</span><span class="op">)</span></span>
<span><span class="va">rel_pct_egg_s</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">posterior_egg</span><span class="op">$</span><span class="va">b_Intercept</span> <span class="op">+</span> <span class="va">posterior_egg</span><span class="op">$</span><span class="va">`b_speciesspathulatha`</span><span class="op">)</span> <span class="op">/</span></span>
<span>  <span class="op">(</span><span class="va">posterior_egg</span><span class="op">$</span><span class="va">b_Intercept</span> <span class="op">+</span> <span class="va">posterior_egg</span><span class="op">$</span><span class="va">`b_speciesspathulatha`</span> <span class="op">+</span></span>
<span>   <span class="va">posterior_egg</span><span class="op">$</span><span class="va">b_treatmentunimpacted</span> <span class="op">+</span> <span class="va">posterior_egg</span><span class="op">$</span><span class="va">`b_treatmentunimpacted:speciesspathulatha`</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Reproductive output</span></span>
<span><span class="va">rel_pct_repro_h</span> <span class="op">&lt;-</span> <span class="va">posterior_repro</span><span class="op">$</span><span class="va">b_Intercept</span> <span class="op">/</span> <span class="op">(</span><span class="va">posterior_repro</span><span class="op">$</span><span class="va">b_Intercept</span> <span class="op">+</span> <span class="va">posterior_repro</span><span class="op">$</span><span class="va">b_treatmentunimpacted</span><span class="op">)</span></span>
<span><span class="va">rel_pct_repro_s</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">posterior_repro</span><span class="op">$</span><span class="va">b_Intercept</span> <span class="op">+</span> <span class="va">posterior_repro</span><span class="op">$</span><span class="va">`b_speciesspathulatha`</span><span class="op">)</span> <span class="op">/</span></span>
<span>  <span class="op">(</span><span class="va">posterior_repro</span><span class="op">$</span><span class="va">b_Intercept</span> <span class="op">+</span> <span class="va">posterior_repro</span><span class="op">$</span><span class="va">`b_speciesspathulatha`</span> <span class="op">+</span></span>
<span>   <span class="va">posterior_repro</span><span class="op">$</span><span class="va">b_treatmentunimpacted</span> <span class="op">+</span> <span class="va">posterior_repro</span><span class="op">$</span><span class="va">`b_treatmentunimpacted:speciesspathulatha`</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Larval development</span></span>
<span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fl">1.5</span></span>
<span><span class="va">time2</span> <span class="op">&lt;-</span> <span class="va">time</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="va">mu_h_impacted</span> <span class="op">&lt;-</span> <span class="va">posterior_dev</span><span class="op">$</span><span class="va">b_Intercept</span> <span class="op">+</span> <span class="va">posterior_dev</span><span class="op">$</span><span class="va">b_time</span> <span class="op">*</span> <span class="va">time</span> <span class="op">+</span> <span class="va">posterior_dev</span><span class="op">$</span><span class="va">`b_ItimeE2`</span> <span class="op">*</span> <span class="va">time2</span></span>
<span><span class="va">mu_h_unimpacted</span> <span class="op">&lt;-</span> <span class="va">mu_h_impacted</span> <span class="op">+</span> <span class="va">posterior_dev</span><span class="op">$</span><span class="va">b_treatmentunimpacted</span> <span class="op">+</span> <span class="va">posterior_dev</span><span class="op">$</span><span class="va">`b_ItimeE2:treatmentunimpacted`</span> <span class="op">*</span> <span class="va">time2</span></span>
<span></span>
<span><span class="va">mu_s_impacted</span> <span class="op">&lt;-</span> <span class="va">mu_h_impacted</span> <span class="op">+</span> <span class="va">posterior_dev</span><span class="op">$</span><span class="va">`b_speciesspathulata`</span> <span class="op">+</span> <span class="va">posterior_dev</span><span class="op">$</span><span class="va">`b_ItimeE2:speciesspathulata`</span> <span class="op">*</span> <span class="va">time2</span></span>
<span><span class="va">mu_s_unimpacted</span> <span class="op">&lt;-</span> <span class="va">mu_s_impacted</span> <span class="op">+</span></span>
<span>  <span class="va">posterior_dev</span><span class="op">$</span><span class="va">b_treatmentunimpacted</span> <span class="op">+</span></span>
<span>  <span class="va">posterior_dev</span><span class="op">$</span><span class="va">`b_ItimeE2:treatmentunimpacted`</span> <span class="op">*</span> <span class="va">time2</span> <span class="op">+</span></span>
<span>  <span class="va">posterior_dev</span><span class="op">$</span><span class="va">`b_treatmentunimpacted:speciesspathulata`</span> <span class="op">+</span></span>
<span>  <span class="va">posterior_dev</span><span class="op">$</span><span class="va">`b_ItimeE2:treatmentunimpacted:speciesspathulata`</span> <span class="op">*</span> <span class="va">time2</span></span>
<span></span>
<span><span class="va">rel_pct_dev_h</span> <span class="op">&lt;-</span> <span class="va">mu_h_impacted</span> <span class="op">/</span> <span class="va">mu_h_unimpacted</span></span>
<span><span class="va">rel_pct_dev_s</span> <span class="op">&lt;-</span> <span class="va">mu_s_impacted</span> <span class="op">/</span> <span class="va">mu_s_unimpacted</span></span>
<span></span>
<span><span class="co">## Settlement (pooled)</span></span>
<span><span class="va">rel_pct_settle</span> <span class="op">&lt;-</span> <span class="va">posterior_settle</span><span class="op">$</span><span class="va">b_Intercept</span> <span class="op">/</span> <span class="op">(</span><span class="va">posterior_settle</span><span class="op">$</span><span class="va">b_Intercept</span> <span class="op">+</span> <span class="va">posterior_settle</span><span class="op">$</span><span class="va">b_treatmentunimpacted</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Recruitment (pooled, log-link)</span></span>
<span><span class="va">mu_impacted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">posterior_recruit</span><span class="op">$</span><span class="va">b_Intercept</span><span class="op">)</span></span>
<span><span class="va">mu_unimpacted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">posterior_recruit</span><span class="op">$</span><span class="va">b_Intercept</span> <span class="op">+</span> <span class="va">posterior_recruit</span><span class="op">$</span><span class="va">b_treatmentunimpacted</span><span class="op">)</span></span>
<span><span class="va">rel_pct_recruit</span> <span class="op">&lt;-</span> <span class="va">mu_impacted</span> <span class="op">/</span> <span class="va">mu_unimpacted</span></span>
<span></span>
<span><span class="co"># ========================</span></span>
<span><span class="co"># 3. Combine and summarise</span></span>
<span><span class="co"># ========================</span></span>
<span></span>
<span><span class="va">combined_draws_h</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rel_pct_egg_h</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rel_pct_repro_h</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rel_pct_dev_h</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rel_pct_settle</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rel_pct_recruit</span><span class="op">)</span> <span class="op">/</span><span class="fl">5</span></span>
<span></span>
<span><span class="va">combined_draws_s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rel_pct_egg_s</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rel_pct_repro_s</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rel_pct_dev_s</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rel_pct_settle</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rel_pct_recruit</span><span class="op">)</span> <span class="op">/</span><span class="fl">5</span></span>
<span></span>
<span></span>
<span><span class="va">posterior_cumulative</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hyacinthus"</span>, <span class="st">"spathulata"</span><span class="op">)</span>,</span>
<span>  oocyte_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rel_pct_egg_h</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rel_pct_egg_s</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  reproductive_biomass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rel_pct_repro_h</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rel_pct_repro_s</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  larval_development <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rel_pct_dev_h</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rel_pct_dev_s</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  larval_settlement <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rel_pct_settle</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rel_pct_settle</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  larval_recruitment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rel_pct_recruit</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rel_pct_recruit</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  cumulative_effect_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">combined_draws_h</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">combined_draws_s</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  cumulative_effect_lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">combined_draws_h</span> <span class="op">-</span> <span class="fl">1</span>, <span class="fl">0.025</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">combined_draws_s</span> <span class="op">-</span> <span class="fl">1</span>, <span class="fl">0.025</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  cumulative_effect_upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">combined_draws_h</span> <span class="op">-</span> <span class="fl">1</span>, <span class="fl">0.975</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">combined_draws_s</span> <span class="op">-</span> <span class="fl">1</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html" class="external-link">where</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>, <span class="va">round</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">cumulative_effect_lower</span>, <span class="op">-</span><span class="va">cumulative_effect_upper</span><span class="op">)</span></span>
<span></span>
<span><span class="va">posterior_cumulative</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span></span>
<span>    options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      pageLength <span class="op">=</span> <span class="fl">5</span>,</span>
<span>      autoWidth <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      dom <span class="op">=</span> <span class="st">'t'</span>,</span>
<span>      columnDefs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>className <span class="op">=</span> <span class="st">'dt-center'</span>, targets <span class="op">=</span> <span class="st">"_all"</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    rownames <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/formatCurrency.html" class="external-link">formatStyle</a></span><span class="op">(</span></span>
<span>    columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">posterior_cumulative</span><span class="op">)</span>,</span>
<span>    fontSize <span class="op">=</span> <span class="st">'70%'</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/formatCurrency.html" class="external-link">formatStyle</a></span><span class="op">(</span></span>
<span>    <span class="st">'species'</span>,</span>
<span>    target <span class="op">=</span> <span class="st">'row'</span>,</span>
<span>    backgroundColor <span class="op">=</span> <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/styleInterval.html" class="external-link">styleEqual</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">posterior_cumulative</span><span class="op">$</span><span class="va">species</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/grDevices/gray.colors.html" class="external-link">gray.colors</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">posterior_cumulative</span><span class="op">$</span><span class="va">species</span><span class="op">)</span><span class="op">)</span>, start <span class="op">=</span> <span class="fl">0.9</span>, end <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</details><div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-2562e034561ad4256ab2" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-2562e034561ad4256ab2">{"x":{"filter":"none","vertical":false,"data":[["hyacinthus","spathulata"],[1,0.8],[1.4,3.2],[0.9,1.6],[2.4,2.4],[1.9,1.9],[0.2,2.9]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>species<\/th>\n      <th>oocyte_size<\/th>\n      <th>reproductive_biomass<\/th>\n      <th>larval_development<\/th>\n      <th>larval_settlement<\/th>\n      <th>larval_recruitment<\/th>\n      <th>cumulative_effect_size<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"autoWidth":true,"dom":"t","columnDefs":[{"className":"dt-center","targets":"_all"},{"name":"species","targets":0},{"name":"oocyte_size","targets":1},{"name":"reproductive_biomass","targets":2},{"name":"larval_development","targets":3},{"name":"larval_settlement","targets":4},{"name":"larval_recruitment","targets":5},{"name":"cumulative_effect_size","targets":6}],"order":[],"orderClasses":false,"lengthMenu":[5,10,25,50,100],"rowCallback":"function(row, data, displayNum, displayIndex, dataIndex) {\nvar value=data[0]; $(this.api().cell(row, 0).node()).css({'font-size':'70%'});\nvar value=data[1]; $(this.api().cell(row, 1).node()).css({'font-size':'70%'});\nvar value=data[2]; $(this.api().cell(row, 2).node()).css({'font-size':'70%'});\nvar value=data[3]; $(this.api().cell(row, 3).node()).css({'font-size':'70%'});\nvar value=data[4]; $(this.api().cell(row, 4).node()).css({'font-size':'70%'});\nvar value=data[5]; $(this.api().cell(row, 5).node()).css({'font-size':'70%'});\nvar value=data[6]; $(this.api().cell(row, 6).node()).css({'font-size':'70%'});\nvar value=data[0]; $(row).css({'background-color':value == \"hyacinthus\" ? \"#E6E6E6\" : value == \"spathulata\" ? \"#CCCCCC\" : null});\n}"}},"evals":["options.rowCallback"],"jsHooks":[]}</script>
</div>
</div>
<pre><code>•   1 = no effect (impacted = unimpacted)
•   &lt;1 = negative effect (impacted &lt; unimpacted)
•   &gt;1 = positive effect (impacted &gt; unimpacted)</code></pre>
<p><img src="images/Figure-1-main.png"></p>

</section></section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/marine.ecologist/" class="external-link">George Roff</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
